:: StoryData
{
	"ifid": "QIYUAN-ROLES-2024",
	"format": "SugarCube",
	"formatVersion": "2.36.1",
	"start": "CharacterSelect",
	"zoom": {
		"text": 1
	}
}

:: StoryInit
// æ¸¸æˆçŠ¶æ€
<<set $currentDay = 1>>
<<set $selectedCharacter = null>>
<<set $gameStarted = false>>

// è§’è‰²å®šä¹‰
<<set $characters = {
	"claudius": {
		name: "å…‹åŠ³ç‹„æ–¯",
		title: "å›½ç‹",
		description: "ä½ æ˜¯ä¸¹éº¦ç‹å…‹åŠ³ç‹„æ–¯ï¼Œè¿™ç‹ä½æœ¬æ˜¯ä½ å“¥å“¥çš„ã€‚ä¸€åœºé˜´è°‹è®©ä»–å‘½ä¸§é»„æ³‰ã€‚è¿™æ·±å®«é‡Œï¼Œè—ç€ä½ çš„ç§˜å¯†ï¼Œé‚£æ˜¯ä½ æœ€æ·±çš„ææƒ§ã€‚",
		initialItems: ["çš‡å† ", "çç é€šå…³ä¿¡ç‰©", "é‡‘é’±"],
		goal: "æ¯’æ­»æŒæœ‰è¯æ®çš„äºº",
		goalKey: "prevent_conspiracy",
		backstory: "ä½ çš„ç‹ä½æ¥è·¯ä¸æ­£ï¼Œè¿™å¯åƒä¸‡ä¸èƒ½è®©äººçŸ¥é“ã€‚å½“å¹´çš„çŸ¥æƒ…äººå·²ç»ä¸å¤šäº†ï¼Œä»…å‰©æœ€åä¸€ä»¶è¯æ®è¿˜æµè½æ°‘é—´ã€‚ä½ å†³å®šåˆ©ç”¨è¿™ä¸ªæ¡ˆä»¶ï¼Œå€Ÿæœºé”€æ¯è¯æ®ã€‚"
	},
	"chengying": {
		name: "ç¨‹å©´",
		title: "å¾¡åŒ»",
		description: "å¤©ä¸‹äººçš†éª‚ä½ ï¼Œå…¶å®ä½ å§è–ªå°èƒ†ï¼Œåªä¸ºæ­å¼€å½“å¹´çš„çœŸç›¸ã€‚",
		initialItems: ["ä¸­è‰è¯", "å®‰çœ è¯"],
		goal: "æ‰¾åˆ°å…ˆç‹çš„æ­»å› ",
		goalKey: "find_cure",
		backstory: "ä½œä¸ºå›½ç‹çš„å¾¡åŒ»ï¼Œä½ æ¢éçš‡å®«ä¸€æ— æ‰€è·ã€‚ä½†æ˜¯å¹´äº‹å·²é«˜ï¼Œææ€•æ—¶æ—¥ä¸å¤šäº†ã€‚æ­£å·§è¿™å›å›½ç‹ä¸‹ä»¤å½»æŸ¥ï¼Œä½ è¦è¶ç€è¿™ä¸ªæœºä¼šè§£å¼€è°œå›¢ã€‚"
	},
	"hefei": {
		name: "ä½•é",
		title: "æ½œæ°´æ•™ç»ƒ",
		description: "ä½ æ˜¯ä¸ªè´ªè´¢å¥½è‰²ä¹‹äººï¼Œå”¯åˆ©æ˜¯å›¾ä½†ä¹Ÿéäº¤æœ‹å‹ã€‚",
		initialItems: ["æ½œæ°´è£…å¤‡", "éª°å­", "ç”»å…·"],
		goal: "åœ¨ä¸‰å¤©å†…è·å–è¶³å¤Ÿçš„é’±è¿˜æ¸…èµŒå€ºã€‚",
		goalKey: "prove_identity",
		backstory: "å…‹åŠ³ç‹„æ–¯ç™»åŸºæ—¶ï¼Œå°äº†æ–°å¤´åƒçš„é’±å¸ã€‚äººäººéƒ½çŸ¥é“ï¼Œä½ æœ€å–œæ¬¢å…‹åŠ³ç‹„æ–¯çš„å¸äº†ã€‚"
	},
	"lixiang": {
		name: "ææƒ³",
		title: "ä¸‹æ°´é“å·¥ç¨‹è®¾è®¡å¸ˆ",
		description: "è´Ÿè´£çš‡å®«çš„ä¸‹æ°´é“å·¥ç¨‹è®¾è®¡ã€‚",
		initialItems: ["åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾"],
		goal: "æ‰¾åˆ°å°¸ä½“ä¸æ˜¯å› ä¸‹æ°´é“è®¾è®¡æœ‰é—®é¢˜é€ æˆçš„æ­»äº¡æ¡ˆä»¶ã€‚",
		goalKey: "discover_secret",
		backstory: "ä½œä¸ºä¸‹æ°´é“ç³»ç»Ÿçš„è®¾è®¡å¸ˆï¼Œè¦æ˜¯è®¾è®¡é—®é¢˜é€ æˆäº†å·¥åŒ æ­»äº¡ï¼Œé‚£å¯æ˜¯å¾ˆä¸¥é‡çš„ã€‚ä½ å¿…é¡»æ‰¾å‡ºçœŸç›¸ã€‚"
	},
	"wuzhizhe": {
		name: "å´æ™ºå“²",
		title: "å»ºç­‘è®¾è®¡å¸ˆ",
		description: "å·²æ•…çš‡å®«æ€»å»ºç­‘è®¾è®¡å¸ˆçš„å…³é—¨å¼Ÿå­ã€‚",
		initialItems: ["çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾", "å¯¼å¸ˆæ‰‹è®°"],
		goal: "åœ¨ä¸‰å¤©å†…æ‰¾åˆ°å¸ˆå‚…ç•™ä¸‹çš„ç§˜å¯†å¹¶ä¿æŠ¤å®ƒ",
		goalKey: "protect_secret",
		backstory: "ä½ çš„å¯¼å¸ˆåœ¨å»ä¸–å‰ç•™ä¸‹äº†ä¸€äº›é‡è¦çš„ç§˜å¯†ã€‚ä½ çŸ¥é“å®ƒä»¬å¾ˆé‡è¦ä½†å¹¶ä¸æ¸…æ¥šç»†èŠ‚ï¼Œå†³å®šä¸€æ¢çœŸç›¸ã€‚"
	},
	"wangweiguo": {
		name: "ç‹å«å›½",
		title: "æ–½å·¥è¿è¾“é˜Ÿé˜Ÿé•¿",
		description: "è´Ÿè´£æ–½å·¥è¿è¾“çš„é˜Ÿé•¿ï¼ŒæŒæ¡ç€ç‰©èµ„å’Œäººå‘˜çš„æµåŠ¨ã€‚",
		initialItems: ["çš‡å®«åœ°å›¾", "å‘¨æŠ¥"],
		goal: "æŒ‰æ—¶äº¤ä»˜çš‡å®«ä¿®å»ºå·¥ç¨‹",
		goalKey: "stop_illegal_transport",
		backstory: "ä½œä¸ºè¿è¾“é˜Ÿé˜Ÿé•¿ï¼Œä½ çš„å›¢é˜Ÿè·ç¦»äº¤ä»˜è¿˜å‰©ä¸‰å¤©ã€‚è¯·æ‰¾åˆ°ä¿®å»ºæ‰€éœ€çš„æ‰€æœ‰ææ–™ï¼Œä¿è¯çš‡å®«æŒ‰æ—¶äº¤ä»˜ã€‚"
	}
}>>

// NPCè§’è‰²ï¼ˆå…¶ä»–5ä¸ªè§’è‰²ï¼‰
<<set $npcs = []>>

// ç©å®¶è£…å¤‡
<<set $playerInventory = []>>

// æ‰€æœ‰è§’è‰²çš„å½“å‰è£…å¤‡ï¼ˆç”¨äºäº¤æ¢ï¼‰
<<set $allCharactersItems = {}>>

// ç›®æ ‡å®ŒæˆçŠ¶æ€
<<set $goalCompleted = false>>

// å·²äº¤æ¢è£…å¤‡çš„è®°å½•ï¼ˆæ¯å¤©åªèƒ½äº¤æ¢ä¸€æ¬¡ï¼‰
<<set $exchangedToday = false>>
<<set $exchangeHistory = []>>

// åˆå§‹åŒ–ä¾§è¾¹æ ç³»ç»Ÿ
<<script>>
(function() {
	'use strict';
	
	// åˆ›å»ºä¾§è¾¹æ å…ƒç´ ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
	function createSidebar() {
		var sidebar = document.getElementById('game-sidebar');
		if (!sidebar) {
			sidebar = document.createElement('div');
			sidebar.id = 'game-sidebar';
			document.body.appendChild(sidebar);
		}
		return sidebar;
	}
	
	// æ›´æ–°ä¾§è¾¹æ çš„å‡½æ•°
	function updateSidebar() {
		var sidebar = createSidebar();
		
		// æ£€æŸ¥æ¸¸æˆçŠ¶æ€
		if (typeof State === 'undefined' || !State.variables) {
			sidebar.style.display = 'none';
			return;
		}
		
		// æ£€æŸ¥å½“å‰passage
		var currentPassage = '';
		try {
			currentPassage = Story.get('passage').title;
		} catch (e) {
			sidebar.style.display = 'none';
			return;
		}
		
		var hideSidebar = currentPassage === 'CharacterSelect' || 
		                  currentPassage === 'About' || 
		                  (currentPassage && currentPassage.indexOf('CharacterClaudius') === 0) ||
		                  (currentPassage && currentPassage.indexOf('CharacterChengying') === 0) ||
		                  (currentPassage && currentPassage.indexOf('CharacterHefei') === 0) ||
		                  (currentPassage && currentPassage.indexOf('CharacterLixiang') === 0) ||
		                  (currentPassage && currentPassage.indexOf('CharacterWuzhizhe') === 0) ||
		                  (currentPassage && currentPassage.indexOf('CharacterWangweiguo') === 0) ||
		                  (currentPassage && currentPassage.indexOf('ConfirmCharacter') === 0) ||
		                  !State.variables.gameStarted || 
		                  !State.variables.selectedCharacter;
		
		if (hideSidebar) {
			sidebar.style.display = 'none';
			var passages = document.querySelectorAll('.passage');
			passages.forEach(function(p) {
				p.style.marginLeft = 'auto';
			});
			return;
		}
		
		// æ˜¾ç¤ºä¾§è¾¹æ å¹¶æ›´æ–°å†…å®¹
		try {
			var char = State.variables.characters[State.variables.selectedCharacter];
			var inventory = State.variables.playerInventory || [];
			var currentDay = State.variables.currentDay || 1;
			
			var html = '<div class="character-info">';
			html += '<strong>è§’è‰²ï¼š</strong>';
			html += '<span>' + char.name + '</span><br>';
			html += '<small style="color: #666;">' + char.title + '</small>';
			html += '</div>';
			
			html += '<h3>ğŸ“¦ èƒŒåŒ…</h3>';
			html += '<div id="inventory-display">';
			if (inventory.length === 0) {
				html += '<div class="inventory-empty">èƒŒåŒ…æ˜¯ç©ºçš„</div>';
			} else {
				for (var i = 0; i < inventory.length; i++) {
					html += '<div class="inventory-item">' + inventory[i] + '</div>';
				}
			}
			html += '</div>';
			
			html += '<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">';
			html += '<strong>ç¬¬ ' + currentDay + ' å¤©</strong>';
			html += '</div>';
			
			sidebar.innerHTML = html;
			sidebar.style.display = 'block';
			
			var passages = document.querySelectorAll('.passage');
			passages.forEach(function(p) {
				p.style.marginLeft = '220px';
			});
		} catch (e) {
			sidebar.style.display = 'none';
		}
	}
	
	// ç­‰å¾…DOMå’ŒSugarCubeåŠ è½½å®Œæˆ
	$(document).one(':storyready', function() {
		createSidebar();
		setTimeout(updateSidebar, 100);
		
		// ç›‘å¬passageæ¸²æŸ“äº‹ä»¶
		$(document).on(':passagerender', function() {
			setTimeout(updateSidebar, 10);
		});

		$(document).on(':passagedisplay', function() {
			setTimeout(updateSidebar, 10);
		});

		// ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œåœ¨ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯ä¹‹é—´åˆ‡æ¢æ—¶æ›´æ–°ä¾§è¾¹æ 
		$(window).on('resize', function() {
			setTimeout(updateSidebar, 100);
		});

		// ESCé”®å…³é—­ç§»åŠ¨ç«¯ä¾§è¾¹æ 
		$(document).on('keydown', function(e) {
			if (e.keyCode === 27) { // ESC key
				closeMobileSidebar();
			}
		});
	});
	
	// ä¹Ÿç›‘å¬DOM readyäº‹ä»¶ï¼ˆä½œä¸ºå¤‡ç”¨ï¼‰
	$(document).ready(function() {
		setTimeout(function() {
			createSidebar();
			updateSidebar();
		}, 200);
	});
})();
<</script>>

:: StoryCaption
<h1>å¥‡ç¼˜è§’è‰²</h1>

:: StoryMenu
<<if $gameStarted>>
	[[ç»§ç»­æ¸¸æˆ|DayStart]]
<<else>>
	[[å¼€å§‹æ¸¸æˆ|CharacterSelect]]
<</if>>
[[å…³äº|About]]

:: UpdateSidebar
<<script>>
	(function() {
		// åˆ›å»ºæˆ–æ›´æ–°ä¾§è¾¹æ 
		var sidebar = document.getElementById('game-sidebar');
		var overlay = document.getElementById('mobile-sidebar-overlay');

		if (!sidebar) {
			sidebar = document.createElement('div');
			sidebar.id = 'game-sidebar';
			sidebar.className = 'collapsed'; // é»˜è®¤æŠ˜å çŠ¶æ€
			document.body.appendChild(sidebar);

			// åˆ›å»ºé®ç½©å±‚ï¼ˆç§»åŠ¨ç«¯ä½¿ç”¨ï¼‰
			overlay = document.createElement('div');
			overlay.id = 'mobile-sidebar-overlay';
			document.body.appendChild(overlay);

			// æ·»åŠ åˆ‡æ¢æŒ‰é’®
			var toggleBtn = document.createElement('button');
			toggleBtn.className = 'sidebar-toggle';
			toggleBtn.innerHTML = 'èƒŒåŒ…';
			toggleBtn.title = 'æŸ¥çœ‹èƒŒåŒ…å’Œè§’è‰²ä¿¡æ¯';
			toggleBtn.onclick = function() {
				var isMobile = window.innerWidth <= 768;
				if (isMobile) {
					// ç§»åŠ¨ç«¯ï¼šåˆ‡æ¢è¦†ç›–å±‚æ¨¡å¼
					var isOpen = sidebar.classList.contains('mobile-open');
					if (isOpen) {
						closeMobileSidebar();
					} else {
						openMobileSidebar();
					}
				} else {
					// æ¡Œé¢ç«¯ï¼šåˆ‡æ¢æŠ˜å æ¨¡å¼
					sidebar.classList.toggle('collapsed');
					var isCollapsed = sidebar.classList.contains('collapsed');
					localStorage.setItem('sidebarCollapsed', isCollapsed);
				}
			};
			sidebar.appendChild(toggleBtn);

			// é®ç½©å±‚ç‚¹å‡»å…³é—­
			overlay.onclick = closeMobileSidebar;

			// ä»æœ¬åœ°å­˜å‚¨æ¢å¤æ¡Œé¢ç«¯çŠ¶æ€
			var savedCollapsed = localStorage.getItem('sidebarCollapsed');
			if (savedCollapsed === 'false') {
				sidebar.classList.remove('collapsed');
			}
		}

		// ç§»åŠ¨ç«¯ä¾§è¾¹æ æ§åˆ¶å‡½æ•°
		function openMobileSidebar() {
			sidebar.classList.add('mobile-open');
			overlay.classList.add('active');
			document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
		}

		function closeMobileSidebar() {
			sidebar.classList.remove('mobile-open');
			overlay.classList.remove('active');
			document.body.style.overflow = ''; // æ¢å¤æ»šåŠ¨
		}

		// å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
		window.openMobileSidebar = openMobileSidebar;
		window.closeMobileSidebar = closeMobileSidebar;

		// æ£€æŸ¥æ¸¸æˆæ˜¯å¦å¼€å§‹
		var isMobile = window.innerWidth <= 768;
		console.log('UpdateSidebar called - isMobile:', isMobile, 'gameStarted:', State.variables.gameStarted, 'selectedCharacter:', State.variables.selectedCharacter);
		if (State.variables.gameStarted && State.variables.selectedCharacter) {
			// æ›´æ–°ä¾§è¾¹æ å†…å®¹
			var char = State.variables.characters[State.variables.selectedCharacter];
			var charName = char.name;
			var charTitle = char.title;
			var inventory = State.variables.playerInventory || [];
			var currentDay = State.variables.currentDay || 1;

			var html = '<div class="sidebar-content">';

			html += '<div class="character-info">';
			html += '<strong>è§’è‰²ï¼š</strong>';
			html += '<span>' + charName + '</span><br>';
			html += '<small style="color: #666;">' + charTitle + '</small>';
			html += '</div>';

			html += '<h3>ğŸ“¦ èƒŒåŒ…</h3>';
			html += '<div id="inventory-display">';
			if (inventory.length === 0) {
				html += '<div class="inventory-empty">èƒŒåŒ…æ˜¯ç©ºçš„</div>';
			} else {
				for (var i = 0; i < inventory.length; i++) {
					html += '<div class="inventory-item">' + inventory[i] + '</div>';
				}
			}
			html += '</div>';

			html += '<div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">';
			html += '<strong>ç¬¬ ' + currentDay + ' å¤©</strong>';
			html += '</div>';

			html += '</div>';

			// æ›´æ–°å†…å®¹ï¼ˆä¿ç•™åˆ‡æ¢æŒ‰é’®ï¼‰
			var contentDiv = sidebar.querySelector('.sidebar-content');
			if (contentDiv) {
				contentDiv.innerHTML = html.slice(22, -7); // ç§»é™¤<div class="sidebar-content">åŒ…è£…
			} else {
				sidebar.insertAdjacentHTML('beforeend', html);
			}

			sidebar.style.display = 'block';

			// ç§»åŠ¨ç«¯ï¼šæ˜¾ç¤ºæµ®åŠ¨æŒ‰é’®
			if (isMobile) {
				showMobileSidebarButton();
			} else {
				hideMobileSidebarButton();
			}
		} else {
			// æ¸¸æˆæœªå¼€å§‹æ—¶éšè—ä¾§è¾¹æ 
			sidebar.style.display = 'none';
			hideMobileSidebarButton();
		}

		// ç§»åŠ¨ç«¯æŒ‰é’®ç®¡ç†å‡½æ•°
		function showMobileSidebarButton() {
			var mobileBtn = document.getElementById('mobile-sidebar-btn');
			if (!mobileBtn) {
				mobileBtn = document.createElement('button');
				mobileBtn.id = 'mobile-sidebar-btn';
				mobileBtn.innerHTML = 'ğŸ“¦';
				mobileBtn.title = 'æŸ¥çœ‹èƒŒåŒ…å’Œè§’è‰²ä¿¡æ¯';
				mobileBtn.style.cssText = `
					position: fixed;
					bottom: 20px;
					right: 20px;
					width: 50px;
					height: 50px;
					border-radius: 50%;
					background: #667eea;
					color: white;
					border: none;
					font-size: 20px;
					box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
					z-index: 1000;
					cursor: pointer;
					transition: all 0.3s ease;
				`;
				mobileBtn.onmouseover = function() {
					this.style.transform = 'scale(1.1)';
					this.style.background = '#764ba2';
				};
				mobileBtn.onmouseout = function() {
					this.style.transform = 'scale(1)';
					this.style.background = '#667eea';
				};
				mobileBtn.onclick = openMobileSidebar;
				document.body.appendChild(mobileBtn);
				console.log('Mobile sidebar button created');
			}
			mobileBtn.style.display = 'block';
			console.log('Mobile sidebar button shown');
		}

		function hideMobileSidebarButton() {
			var mobileBtn = document.getElementById('mobile-sidebar-btn');
			if (mobileBtn) {
				mobileBtn.style.display = 'none';
				console.log('Mobile sidebar button hidden');
			}
		}
	})();
<</script>>

:: StoryInterface
<div id="passages"></div>

:: stylesheet [stylesheet]
/* è‡ªå®šä¹‰æ ·å¼è¡¨ - è¦†ç›– Twine é»˜è®¤æ ·å¼ */

body {
	font-family: 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: #333;
}

.passage {
	background: rgba(255, 255, 255, 0.95);
	border-radius: 10px;
	padding: 2em;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	max-width: 800px;
	margin: 0 auto;
	transition: margin-left 0.3s ease;
}

/* è§’è‰²é€‰æ‹©é¡µé¢ç‰¹æ®Šæ ·å¼ */
.character-select-grid {
	text-align: left !important;
	margin: 20px auto !important;
	max-width: 800px !important;
	width: 100% !important;
}

/* å“åº”å¼è®¾è®¡ - å°å±å¹•ä¸Šæ”¹ä¸ºå•åˆ—å¸ƒå±€ */
@media (max-width: 768px) {
	.character-select-grid {
		grid-template-columns: 1fr !important;
		max-width: 100% !important;
		margin: 20px 10px !important;
	}

	.no-sidebar-margin .passage {
		padding-left: 1em !important;
		padding-right: 1em !important;
	}
}

.passage a {
	color: #667eea;
	text-decoration: none;
	border-bottom: 2px solid #667eea;
	transition: all 0.3s ease;
}

.passage a:hover {
	color: #764ba2;
	border-bottom-color: #764ba2;
	background: rgba(102, 126, 234, 0.1);
	padding: 2px 4px;
	border-radius: 3px;
}

/* è§’è‰²é€‰æ‹©é¡µé¢çš„æŒ‰é’®æ ·å¼ */
.character-select-grid a {
	display: inline-block;
	padding: 10px 20px;
	background: #667eea;
	color: white !important;
	border: none !important;
	border-radius: 5px;
	text-decoration: none;
	margin-top: 10px;
	transition: background 0.3s ease;
	font-weight: bold;
}

.character-select-grid a:hover {
	background: #764ba2;
	color: white !important;
	border-bottom: none !important;
	padding: 10px 20px;
}

/* è§’è‰²è¯¦æƒ…é¡µé¢çš„"å¼€å¯æ—…é€”"æŒ‰é’®æ ·å¼ */
.start-journey-button {
	margin-top: 20px;
	text-align: center;
}

.start-journey-button a {
	display: inline-block;
	padding: 12px 30px;
	background: #667eea;
	color: white !important;
	border: none !important;
	border-radius: 5px;
	text-decoration: none;
	transition: background 0.3s ease;
	font-weight: bold;
	font-size: 1.1em;
}

.start-journey-button a:hover {
	background: #764ba2;
	color: white !important;
	border-bottom: none !important;
	padding: 12px 30px;
}

/* è‡ªå®šä¹‰æŒ‰é’®æ ·å¼ */
.link-internal {
	display: inline-block;
	margin: 0.5em;
	padding: 0.5em 1em;
	background: #667eea;
	color: white;
	border-radius: 5px;
	border: none;
	cursor: pointer;
	transition: background 0.3s ease;
}

.link-internal:hover {
	background: #764ba2;
}

/* ä¾§è¾¹æ æ ·å¼ */
#game-sidebar {
	position: fixed;
	left: 0;
	top: 0;
	width: 200px;
	height: 100vh;
	background: rgba(255, 255, 255, 0.98);
	box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
	overflow-y: auto;
	z-index: 1000;
	padding: 20px;
	box-sizing: border-box;
	font-size: 14px;
	transition: transform 0.3s ease, width 0.3s ease;
}

#game-sidebar.collapsed {
	width: 50px;
	padding: 15px 10px;
	transform: translateX(-150px); /* éšè—ä¸»è¦å†…å®¹ï¼Œåªç•™åˆ‡æ¢æŒ‰é’® */
}

#game-sidebar .sidebar-toggle {
	position: absolute;
	right: -15px;
	top: 20px;
	width: 30px;
	height: 30px;
	background: #667eea;
	color: white;
	border: none;
	border-radius: 50%;
	cursor: pointer;
	z-index: 1001;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 16px;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
	transition: all 0.3s ease;
}

#game-sidebar.collapsed .sidebar-toggle {
	right: -15px;
	transform: rotate(180deg);
}

#game-sidebar .sidebar-toggle:hover {
	background: #764ba2;
	transform: scale(1.1);
}

#game-sidebar .sidebar-toggle:active {
	transform: scale(0.95);
}

#game-sidebar .sidebar-content {
	opacity: 1;
	transition: opacity 0.3s ease;
}

#game-sidebar.collapsed .sidebar-content {
	opacity: 0;
	pointer-events: none;
}

#game-sidebar.hidden {
	display: none;
}

#game-sidebar h3 {
	margin-top: 0;
	margin-bottom: 15px;
	color: #667eea;
	border-bottom: 2px solid #667eea;
	padding-bottom: 10px;
	font-size: 16px;
}

#game-sidebar .inventory-item {
	padding: 8px;
	margin: 5px 0;
	background: #f5f5f5;
	border-radius: 5px;
	border-left: 3px solid #667eea;
	font-size: 13px;
}

#game-sidebar .inventory-empty {
	color: #999;
	font-style: italic;
	padding: 10px;
	text-align: center;
	font-size: 12px;
}

#game-sidebar .character-info {
	margin-bottom: 20px;
	padding-bottom: 15px;
	border-bottom: 1px solid #ddd;
}

#game-sidebar .character-info strong {
	color: #667eea;
	display: block;
	margin-bottom: 5px;
	font-size: 14px;
}

#game-sidebar .character-info span {
	font-size: 16px;
	font-weight: bold;
}

#game-sidebar .character-info small {
	font-size: 12px;
}

/* å½“ä¾§è¾¹æ æ˜¾ç¤ºä¸”å±•å¼€æ—¶ï¼Œè°ƒæ•´ä¸»å†…å®¹åŒºåŸŸ */
#game-sidebar:not([style*="display: none"]):not(.collapsed) ~ * .passage,
body:has(#game-sidebar:not([style*="display: none"]):not(.collapsed)) .passage {
	margin-left: 220px;
}

/* è§’è‰²é€‰æ‹©é¡µé¢å’Œå…¶ä»–éæ¸¸æˆé¡µé¢ï¼Œä¸åº”ç”¨ä¾§è¾¹æ è¾¹è· */
.no-sidebar-margin .passage,
.passage:has(.character-select-grid) {
	margin-left: 0 !important;
	max-width: none !important;
	padding-left: 2em !important;
	padding-right: 2em !important;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
	/* ç§»åŠ¨ç«¯ä¾§è¾¹æ æ”¹ä¸ºè¦†ç›–å±‚æ¨¡å¼ */
	#game-sidebar {
		position: fixed !important;
		top: 0 !important;
		left: 0 !important;
		width: 280px !important;
		height: 100vh !important;
		background: rgba(255, 255, 255, 0.98) !important;
		box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3) !important;
		z-index: 10000 !important;
		transform: translateX(-100%) !important; /* é»˜è®¤éšè— */
		transition: transform 0.3s ease !important;
	}

	#game-sidebar.mobile-open {
		transform: translateX(0) !important; /* æ˜¾ç¤ºæ—¶ä»å·¦ä¾§æ»‘å…¥ */
	}

	/* ç§»åŠ¨ç«¯åˆ‡æ¢æŒ‰é’®ä½ç½®è°ƒæ•´ */
	#game-sidebar .sidebar-toggle {
		right: -50px !important;
		top: 50% !important;
		transform: translateY(-50%) rotate(90deg) !important;
		background: #667eea !important;
		border-radius: 20px 20px 0 0 !important;
		padding: 8px 12px !important;
		font-size: 14px !important;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
	}

	#game-sidebar.mobile-open .sidebar-toggle {
		right: -50px !important;
		transform: translateY(-50%) rotate(90deg) scaleX(-1) !important; /* ç¿»è½¬æ–‡å­— */
	}

	/* ç§»åŠ¨ç«¯ä¸»å†…å®¹åŒºåŸŸ */
	.passage {
		margin-left: 0 !important;
		padding-left: 1em !important;
		padding-right: 1em !important;
		transition: none !important;
	}

	/* ç§»åŠ¨ç«¯é®ç½©å±‚ */
	#mobile-sidebar-overlay {
		display: none;
		position: fixed;
		top: 0;
		left: 0;
		width: 100vw;
		height: 100vh;
		background: rgba(0, 0, 0, 0.5);
		z-index: 9999;
	}

	#mobile-sidebar-overlay.active {
		display: block !important;
	}
}

@media (max-width: 480px) {
	/* å°å±å¹•ä½¿ç”¨è¦†ç›–å±‚æ¨¡å¼ */
	#game-sidebar {
		width: 100vw !important;
		max-width: 320px !important;
	}

	#game-sidebar .sidebar-toggle {
		right: -60px !important;
		padding: 6px 10px !important;
		font-size: 12px !important;
	}

	/* å°å±å¹•æµ®åŠ¨æŒ‰é’®è°ƒæ•´ */
	#mobile-sidebar-btn {
		bottom: 15px !important;
		right: 15px !important;
		width: 45px !important;
		height: 45px !important;
		font-size: 18px !important;
	}
}

/* ç¡®ä¿ä¾§è¾¹æ åœ¨æ­£ç¡®ä½ç½® */
#game-sidebar {
	position: fixed !important;
}

:: CharacterSelect
<div class="no-sidebar-margin">
<h2>é€‰æ‹©ä½ çš„è§’è‰²</h2>

<p>ä¼Ÿå¤§çš„ä¸¹éº¦ç‹å…‹åŠ³ç‹„æ–¯æ­£åœ¨ä¿®å»ºä»–çš„å®«æ®¿ï¼Œå¦‚ä»Šè·ç¦»é¢„è®¡äº¤ä»˜ä»…å‰©3å¤©ï¼Œçªå‘å·¨å˜ï¼</p>

<p>æ–½å·¥è¿è¾“é˜Ÿé•¿ç‹å«å›½å¿½ç„¶æŠ¥å‘Šå‘ç°ä¸€å…·æ— åå°¸ä½“ï¼Œè¿™è®©æ•´ä¸ªçš‡å®«ç¬¼ç½©åœ¨é˜´è°‹å’Œç§˜å¯†ä¹‹ä¸­ï¼Œæ–½å·¥è¿›åº¦ä¹Ÿåœæ»ä¸å‰ã€‚</p>

<p><em>è¯·é€‰æ‹©ä½ çš„è§’è‰²ï¼Œå¹¶æŸ¥çœ‹è§’è‰²è¯¦æƒ…ã€‚</em></p>

<div class="character-select-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin: 20px auto; max-width: 800px; width: 100%;">
	<div style="border: 2px solid #667eea; padding: 15px; border-radius: 8px;">
		<h3>å…‹åŠ³ç‹„æ–¯ - å›½ç‹</h3>
		<p><em>å¨ä¸¥çš„å›½ç‹ï¼ŒæŒæ¡ç€ç‹å›½çš„æœ€é«˜æƒåŠ›ã€‚</em></p>
		<div style="margin-top: 10px;">[[é€‰æ‹©è§’è‰²|CharacterClaudius]]</div>
	</div>
	
	<div style="border: 2px solid #667eea; padding: 15px; border-radius: 8px;">
		<h3>ç¨‹å©´ - å¾¡åŒ»</h3>
		<p><em>åŒ»æœ¯é«˜æ˜ä½†é£è¯„éå¸¸é˜´ç‹ çš„å¾¡åŒ»ï¼Œä¼ è¯´å°±æ˜¯ä»–æ›¾é™·å®³æ­»äº†å…¬å­™æµè‡¼ã€‚</em></p>
		<div style="margin-top: 10px;">[[é€‰æ‹©è§’è‰²|CharacterChengying]]</div>
	</div>
	
	<div style="border: 2px solid #667eea; padding: 15px; border-radius: 8px;">
		<h3>ä½•é - æ½œæ°´æ•™ç»ƒ</h3>
		<p><em>æ½œæ°´æ•™ç»ƒï¼Œæ¶ˆæ¯éå¸¸çµé€šï¼Œä»€ä¹ˆäººéƒ½è®¤è¯†ã€‚å†™ä½œæ±Ÿæ¹–ç™¾æ™“ç”Ÿè¯»ä½œæ±Ÿæ¹–éª—å­ã€‚</em></p>
		<div style="margin-top: 10px;">[[é€‰æ‹©è§’è‰²|CharacterHefei]]</div>
	</div>
	
	<div style="border: 2px solid #667eea; padding: 15px; border-radius: 8px;">
		<h3>ææƒ³ - ä¸‹æ°´é“å·¥ç¨‹è®¾è®¡å¸ˆ</h3>
		<p><em>çš‡å®«ç»™æ’æ°´ç³»ç»Ÿæ€»å·¥ç¨‹å¸ˆï¼Œä»£è¡¨ä½œæ˜¯å»ºè®¾è¿‡æ–°åŸã€‚</em></p>
		<div style="margin-top: 10px;">[[é€‰æ‹©è§’è‰²|CharacterLixiang]]</div>
	</div>
	
	<div style="border: 2px solid #667eea; padding: 15px; border-radius: 8px;">
		<h3>å´æ™ºå“² - å»ºç­‘è®¾è®¡å¸ˆ</h3>
		<p><em>å·²æ•…çš‡å®«æ€»å»ºç­‘è®¾è®¡å¸ˆçš„å…³é—¨å¼Ÿå­ï¼Œä¹Ÿæ˜¯ä¸€ä½å»ºç­‘å¸ˆã€‚</em></p>
		<div style="margin-top: 10px;">[[é€‰æ‹©è§’è‰²|CharacterWuzhizhe]]</div>
	</div>
	
	<div style="border: 2px solid #667eea; padding: 15px; border-radius: 8px;">
		<h3>ç‹å«å›½ - æ–½å·¥è¿è¾“é˜Ÿé˜Ÿé•¿</h3>
		<p><em>æœ¬æ¬¡æ–½å·¥çš„è¿è¾“é˜Ÿé˜Ÿé•¿ï¼Œç†ŸçŸ¥çš‡å®«æ¯æ—¥æ–½å·¥è¿›åº¦ã€‚</em></p>
		<div style="margin-top: 10px;">[[é€‰æ‹©è§’è‰²|CharacterWangweiguo]]</div>
	</div>
</div>
</div>

:: CharacterClaudius
<<set $char = $characters.claudius>>

<h2>å…‹åŠ³ç‹„æ–¯ - å›½ç‹</h2>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ä½ çš„çœŸå®èº«ä»½</h3>
	<p style="font-size: 1.05em; line-height: 1.6;">$char.description</p>
</div>

<div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“– ä½ çš„æ•…äº‹</h3>
	<p style="line-height: 1.6;">$char.backstory</p>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ä¸»çº¿ä»»åŠ¡</h3>
	<p style="font-size: 1.05em; font-weight: bold; color: #e65100; line-height: 1.6;">$char.goal</p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ åˆå§‹è£…å¤‡</h3>
	<<set _itemDescriptions = {
		"çš‡å† ": "è±¡å¾ç‹æƒçš„çš‡å† ï¼Œä»£è¡¨ç€ä½ çš„åœ°ä½å’ŒæƒåŠ›ã€‚",
		"çç é€šå…³ä¿¡ç‰©": "ä¸€æšçè´µçš„çç ä¿¡ç‰©ï¼Œå¯ä»¥åœ¨çš‡å®«ä¸­è‡ªç”±é€šè¡Œã€‚",
		"é‡‘é’±": "å¤§é‡çš„é‡‘å¸ï¼Œå¯ä»¥ç”¨æ¥æ”¶ä¹°äººå¿ƒæˆ–è·å–ä¿¡æ¯ã€‚"
	}>>
	<ul style="list-style: none; padding-left: 0;">
	<<for _i = 0; _i < $char.initialItems.length; _i++>>
		<<set _item = $char.initialItems[_i]>>
		<<set _desc = _itemDescriptions[_item]>>
		<li style="padding: 8px 0; border-bottom: 1px solid #ddd;">
			<strong><<print _item>></strong>
			<<if _desc>>
			<p style="margin: 5px 0 0 0; color: #666; font-size: 0.9em;"><<print _desc>></p>
			<</if>>
		</li>
	<</for>>
	</ul>
</div>

<div class="start-journey-button">[[å¼€å¯æ—…é€”|ConfirmClaudius]]</div>

:: CharacterChengying
<<set $char = $characters.chengying>>

<h2>ç¨‹å©´ - å¾¡åŒ»</h2>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ä½ çš„çœŸå®èº«ä»½</h3>
	<p style="font-size: 1.05em; line-height: 1.6;">$char.description</p>
</div>

<div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“– ä½ çš„æ•…äº‹</h3>
	<p style="line-height: 1.6;">$char.backstory</p>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ä¸»çº¿ä»»åŠ¡</h3>
	<p style="font-size: 1.05em; font-weight: bold; color: #e65100; line-height: 1.6;">$char.goal</p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ åˆå§‹è£…å¤‡</h3>
	<<set _itemDescriptions = {
		"ä¸­è‰è¯": "ä½ ç²¾å¿ƒè°ƒé…çš„ä¸­è‰è¯ï¼Œå¯ä»¥ç”¨æ¥æ²»ç–—æˆ–åˆ†æç—…æƒ…ã€‚",
		"å®‰çœ è¯": "å¼ºæ•ˆçš„å®‰çœ è¯ç‰©ï¼Œå¯ä»¥è®©äººé™·å…¥æ·±åº¦ç¡çœ ã€‚"
	}>>
	<ul style="list-style: none; padding-left: 0;">
	<<for _i = 0; _i < $char.initialItems.length; _i++>>
		<<set _item = $char.initialItems[_i]>>
		<<set _desc = _itemDescriptions[_item]>>
		<li style="padding: 8px 0; border-bottom: 1px solid #ddd;">
			<strong><<print _item>></strong>
			<<if _desc>>
			<p style="margin: 5px 0 0 0; color: #666; font-size: 0.9em;"><<print _desc>></p>
			<</if>>
		</li>
	<</for>>
	</ul>
</div>

<div class="start-journey-button">[[å¼€å¯æ—…é€”|ConfirmChengying]]</div>

:: CharacterHefei
<<set $char = $characters.hefei>>

<h2>ä½•é - æ½œæ°´æ•™ç»ƒ</h2>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ä½ çš„çœŸå®èº«ä»½</h3>
	<p style="font-size: 1.05em; line-height: 1.6;">$char.description</p>
</div>

<div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“– ä½ çš„æ•…äº‹</h3>
	<p style="line-height: 1.6;">$char.backstory</p>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ä¸»çº¿ä»»åŠ¡</h3>
	<p style="font-size: 1.05em; font-weight: bold; color: #e65100; line-height: 1.6;">$char.goal</p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ åˆå§‹è£…å¤‡</h3>
	<<set _itemDescriptions = {
		"æ½œæ°´è£…å¤‡": "ä¸“ä¸šçš„æ½œæ°´è®¾å¤‡ï¼Œå¯ä»¥æ¢ç´¢æ°´ä¸‹åŒºåŸŸã€‚",
		"éª°å­": "ä½ å¸¸ç”¨çš„éª°å­ï¼Œåœ¨èµŒå±€ä¸­èƒ½å¸¦æ¥å¥½è¿ã€‚",
		"ç”»å…·": "ä¸€å¥—å®Œæ•´çš„ç»˜ç”»å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥è®°å½•æˆ–ä¼ªé€ ä¿¡æ¯ã€‚"
	}>>
	<ul style="list-style: none; padding-left: 0;">
	<<for _i = 0; _i < $char.initialItems.length; _i++>>
		<<set _item = $char.initialItems[_i]>>
		<<set _desc = _itemDescriptions[_item]>>
		<li style="padding: 8px 0; border-bottom: 1px solid #ddd;">
			<strong><<print _item>></strong>
			<<if _desc>>
			<p style="margin: 5px 0 0 0; color: #666; font-size: 0.9em;"><<print _desc>></p>
			<</if>>
		</li>
	<</for>>
	</ul>
</div>

<div class="start-journey-button">[[å¼€å¯æ—…é€”|ConfirmHefei]]</div>

:: CharacterLixiang
<<set $char = $characters.lixiang>>

<h2>ææƒ³ - ä¸‹æ°´é“å·¥ç¨‹è®¾è®¡å¸ˆ</h2>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ä½ çš„çœŸå®èº«ä»½</h3>
	<p style="font-size: 1.05em; line-height: 1.6;">$char.description</p>
</div>

<div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“– ä½ çš„æ•…äº‹</h3>
	<p style="line-height: 1.6;">$char.backstory</p>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ä¸»çº¿ä»»åŠ¡</h3>
	<p style="font-size: 1.05em; font-weight: bold; color: #e65100; line-height: 1.6;">$char.goal</p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ åˆå§‹è£…å¤‡</h3>
	<<set _itemDescriptions = {
		"åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾": "ä½ äº²æ‰‹ç»˜åˆ¶çš„çš‡å®«åœ°ä¸‹ç³»ç»Ÿå®Œæ•´è®¾è®¡å›¾ï¼Œè¯¦ç»†æ ‡æ³¨äº†æ‰€æœ‰é€šé“å’Œç»“æ„ã€‚"
	}>>
	<ul style="list-style: none; padding-left: 0;">
	<<for _i = 0; _i < $char.initialItems.length; _i++>>
		<<set _item = $char.initialItems[_i]>>
		<<set _desc = _itemDescriptions[_item]>>
		<li style="padding: 8px 0; border-bottom: 1px solid #ddd;">
			<strong><<print _item>></strong>
			<<if _desc>>
			<p style="margin: 5px 0 0 0; color: #666; font-size: 0.9em;"><<print _desc>></p>
			<</if>>
		</li>
	<</for>>
	</ul>
</div>

<div class="start-journey-button">[[å¼€å¯æ—…é€”|ConfirmLixiang]]</div>

:: CharacterWuzhizhe
<<set $char = $characters.wuzhizhe>>

<h2>å´æ™ºå“² - å»ºç­‘è®¾è®¡å¸ˆ</h2>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ä½ çš„çœŸå®èº«ä»½</h3>
	<p style="font-size: 1.05em; line-height: 1.6;">$char.description</p>
</div>

<div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“– ä½ çš„æ•…äº‹</h3>
	<p style="line-height: 1.6;">$char.backstory</p>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ä¸»çº¿ä»»åŠ¡</h3>
	<p style="font-size: 1.05em; font-weight: bold; color: #e65100; line-height: 1.6;">$char.goal</p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ åˆå§‹è£…å¤‡</h3>
	<<set _itemDescriptions = {
		"çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾": "çš‡å®«åœ°é¢å»ºç­‘çš„å®Œæ•´è®¾è®¡å›¾çº¸ï¼Œæ ‡æ³¨äº†æ‰€æœ‰æˆ¿é—´å’Œé€šé“ã€‚",
		"å¯¼å¸ˆæ‰‹è®°": "ä½ å·²æ•…å¯¼å¸ˆç•™ä¸‹çš„æ‰‹è®°ï¼Œè®°å½•ç€çš‡å®«å»ºç­‘çš„ç§˜å¯†å’Œå…³é”®ä¿¡æ¯ã€‚"
	}>>
	<ul style="list-style: none; padding-left: 0;">
	<<for _i = 0; _i < $char.initialItems.length; _i++>>
		<<set _item = $char.initialItems[_i]>>
		<<set _desc = _itemDescriptions[_item]>>
		<li style="padding: 8px 0; border-bottom: 1px solid #ddd;">
			<strong><<print _item>></strong>
			<<if _desc>>
			<p style="margin: 5px 0 0 0; color: #666; font-size: 0.9em;"><<print _desc>></p>
			<</if>>
		</li>
	<</for>>
	</ul>
</div>

<div class="start-journey-button">[[å¼€å¯æ—…é€”|ConfirmWuzhizhe]]</div>

:: CharacterWangweiguo
<<set $char = $characters.wangweiguo>>

<h2>ç‹å«å›½ - æ–½å·¥è¿è¾“é˜Ÿé˜Ÿé•¿</h2>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ä½ çš„çœŸå®èº«ä»½</h3>
	<p style="font-size: 1.05em; line-height: 1.6;">$char.description</p>
</div>

<div style="background: #e3f2fd; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“– ä½ çš„æ•…äº‹</h3>
	<p style="line-height: 1.6;">$char.backstory</p>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ä¸»çº¿ä»»åŠ¡</h3>
	<p style="font-size: 1.05em; font-weight: bold; color: #e65100; line-height: 1.6;">$char.goal</p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ åˆå§‹è£…å¤‡</h3>
	<<set _itemDescriptions = {
		"çš‡å®«åœ°å›¾": "è¯¦ç»†çš„çš‡å®«åœ°å›¾ï¼Œæ ‡æ³¨äº†æ‰€æœ‰é‡è¦ä½ç½®å’Œè¿è¾“è·¯çº¿ã€‚",
		"å‘¨æŠ¥": "è®°å½•æ¯å‘¨æ–½å·¥è¿›åº¦å’Œç‰©èµ„è¿è¾“æƒ…å†µçš„å‘¨æŠ¥ï¼ŒåŒ…å«é‡è¦ä¿¡æ¯ã€‚"
	}>>
	<ul style="list-style: none; padding-left: 0;">
	<<for _i = 0; _i < $char.initialItems.length; _i++>>
		<<set _item = $char.initialItems[_i]>>
		<<set _desc = _itemDescriptions[_item]>>
		<li style="padding: 8px 0; border-bottom: 1px solid #ddd;">
			<strong><<print _item>></strong>
			<<if _desc>>
			<p style="margin: 5px 0 0 0; color: #666; font-size: 0.9em;"><<print _desc>></p>
			<</if>>
		</li>
	<</for>>
	</ul>
</div>

<div class="start-journey-button">[[å¼€å¯æ—…é€”|ConfirmWangweiguo]]</div>

:: ConfirmClaudius
<<set $selectedCharacter = "claudius">>
<<set $char = $characters.claudius>>

<<silently>>
	// åˆå§‹åŒ–ç©å®¶è£…å¤‡
	<<set $playerInventory = $char.initialItems.slice()>>
	
	// åˆå§‹åŒ–æ‰€æœ‰è§’è‰²çš„è£…å¤‡ï¼ˆåŒ…æ‹¬NPCï¼‰
	<<set $allCharactersItems = {}>>
	<<set $allCharactersItems["claudius"] = $char.initialItems.slice()>>
	
	// åˆ›å»ºNPCåˆ—è¡¨ï¼ˆå…¶ä»–5ä¸ªè§’è‰²ï¼‰
	<<set $npcs = []>>
	<<set _charKeys = Object.keys($characters)>>
	<<for _i = 0; _i < _charKeys.length; _i++>>
		<<set _key = _charKeys[_i]>>
		<<set _char = $characters[_key]>>
		<<if _key neq "claudius">>
			<<set $allCharactersItems[_key] = _char.initialItems.slice()>>
			<<set $npcs.push({
				id: _key,
				name: _char.name,
				title: _char.title,
				items: _char.initialItems.slice()
			})>>
		<</if>>
	<</for>>
	
	// é‡ç½®æ¸¸æˆçŠ¶æ€
	<<set $currentDay = 1>>
	<<set $goalCompleted = false>>
	<<set $exchangedToday = false>>
	<<set $exchangeHistory = []>>
	<<set $gameStarted = true>>
<</silently>>

<h2>è§’è‰²ç¡®è®¤</h2>

<div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<p><strong>ä½ é€‰æ‹©äº†ï¼š$char.name</strong> - $char.title</p>
	<p><em>$char.description</em></p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ ä½ çš„åˆå§‹è£…å¤‡ï¼š</h3>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li style="padding: 5px 0;">$playerInventory[_i]</li>
	<</for>>
	</ul>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ç›®æ ‡ï¼š</h3>
	<p style="font-size: 1.1em; font-weight: bold; color: #e65100;">$char.goal</p>
</div>

<p>æ¸¸æˆå°†åœ¨ä¸‰å¤©å†…è¿›è¡Œã€‚æ¯å¤©ç™½å¤©ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªå…¶ä»–è§’è‰²è¿›è¡Œè£…å¤‡äº¤æ¢ã€‚</p>

<p><em>æ³¨æ„ï¼šå·¦ä¾§çš„èƒŒåŒ…èœå•ä¼šå®æ—¶æ˜¾ç¤ºä½ å½“å‰çš„è£…å¤‡ï¼ŒåŒ…æ‹¬äº¤æ¢åçš„è£…å¤‡ã€‚</em></p>

[[å¼€å§‹ç¬¬ä¸€å¤©|DayStart]]

:: ConfirmChengying
<<set $selectedCharacter = "chengying">>
<<set $char = $characters.chengying>>

<<silently>>
	// åˆå§‹åŒ–ç©å®¶è£…å¤‡
	<<set $playerInventory = $char.initialItems.slice()>>
	
	// åˆå§‹åŒ–æ‰€æœ‰è§’è‰²çš„è£…å¤‡ï¼ˆåŒ…æ‹¬NPCï¼‰
	<<set $allCharactersItems = {}>>
	<<set $allCharactersItems["chengying"] = $char.initialItems.slice()>>
	
	// åˆ›å»ºNPCåˆ—è¡¨ï¼ˆå…¶ä»–5ä¸ªè§’è‰²ï¼‰
	<<set $npcs = []>>
	<<set _charKeys = Object.keys($characters)>>
	<<for _i = 0; _i < _charKeys.length; _i++>>
		<<set _key = _charKeys[_i]>>
		<<set _char = $characters[_key]>>
		<<if _key neq "chengying">>
			<<set $allCharactersItems[_key] = _char.initialItems.slice()>>
			<<set $npcs.push({
				id: _key,
				name: _char.name,
				title: _char.title,
				items: _char.initialItems.slice()
			})>>
		<</if>>
	<</for>>
	
	// é‡ç½®æ¸¸æˆçŠ¶æ€
	<<set $currentDay = 1>>
	<<set $goalCompleted = false>>
	<<set $exchangedToday = false>>
	<<set $exchangeHistory = []>>
	<<set $gameStarted = true>>
<</silently>>

<h2>è§’è‰²ç¡®è®¤</h2>

<div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<p><strong>ä½ é€‰æ‹©äº†ï¼š$char.name</strong> - $char.title</p>
	<p><em>$char.description</em></p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ ä½ çš„åˆå§‹è£…å¤‡ï¼š</h3>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li style="padding: 5px 0;">$playerInventory[_i]</li>
	<</for>>
	</ul>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ç›®æ ‡ï¼š</h3>
	<p style="font-size: 1.1em; font-weight: bold; color: #e65100;">$char.goal</p>
</div>

<p>æ¸¸æˆå°†åœ¨ä¸‰å¤©å†…è¿›è¡Œã€‚æ¯å¤©ç™½å¤©ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªå…¶ä»–è§’è‰²è¿›è¡Œè£…å¤‡äº¤æ¢ã€‚</p>

<p><em>æ³¨æ„ï¼šå·¦ä¾§çš„èƒŒåŒ…èœå•ä¼šå®æ—¶æ˜¾ç¤ºä½ å½“å‰çš„è£…å¤‡ï¼ŒåŒ…æ‹¬äº¤æ¢åçš„è£…å¤‡ã€‚</em></p>

[[å¼€å§‹ç¬¬ä¸€å¤©|DayStart]]

:: ConfirmHefei
<<set $selectedCharacter = "hefei">>
<<set $char = $characters.hefei>>

<<silently>>
	// åˆå§‹åŒ–ç©å®¶è£…å¤‡
	<<set $playerInventory = $char.initialItems.slice()>>
	
	// åˆå§‹åŒ–æ‰€æœ‰è§’è‰²çš„è£…å¤‡ï¼ˆåŒ…æ‹¬NPCï¼‰
	<<set $allCharactersItems = {}>>
	<<set $allCharactersItems["hefei"] = $char.initialItems.slice()>>
	
	// åˆ›å»ºNPCåˆ—è¡¨ï¼ˆå…¶ä»–5ä¸ªè§’è‰²ï¼‰
	<<set $npcs = []>>
	<<set _charKeys = Object.keys($characters)>>
	<<for _i = 0; _i < _charKeys.length; _i++>>
		<<set _key = _charKeys[_i]>>
		<<set _char = $characters[_key]>>
		<<if _key neq "hefei">>
			<<set $allCharactersItems[_key] = _char.initialItems.slice()>>
			<<set $npcs.push({
				id: _key,
				name: _char.name,
				title: _char.title,
				items: _char.initialItems.slice()
			})>>
		<</if>>
	<</for>>
	
	// é‡ç½®æ¸¸æˆçŠ¶æ€
	<<set $currentDay = 1>>
	<<set $goalCompleted = false>>
	<<set $exchangedToday = false>>
	<<set $exchangeHistory = []>>
	<<set $gameStarted = true>>
<</silently>>

<h2>è§’è‰²ç¡®è®¤</h2>

<div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<p><strong>ä½ é€‰æ‹©äº†ï¼š$char.name</strong> - $char.title</p>
	<p><em>$char.description</em></p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ ä½ çš„åˆå§‹è£…å¤‡ï¼š</h3>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li style="padding: 5px 0;">$playerInventory[_i]</li>
	<</for>>
	</ul>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ç›®æ ‡ï¼š</h3>
	<p style="font-size: 1.1em; font-weight: bold; color: #e65100;">$char.goal</p>
</div>

<p>æ¸¸æˆå°†åœ¨ä¸‰å¤©å†…è¿›è¡Œã€‚æ¯å¤©ç™½å¤©ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªå…¶ä»–è§’è‰²è¿›è¡Œè£…å¤‡äº¤æ¢ã€‚</p>

<p><em>æ³¨æ„ï¼šå·¦ä¾§çš„èƒŒåŒ…èœå•ä¼šå®æ—¶æ˜¾ç¤ºä½ å½“å‰çš„è£…å¤‡ï¼ŒåŒ…æ‹¬äº¤æ¢åçš„è£…å¤‡ã€‚</em></p>

[[å¼€å§‹ç¬¬ä¸€å¤©|DayStart]]

:: ConfirmLixiang
<<set $selectedCharacter = "lixiang">>
<<set $char = $characters.lixiang>>

<<silently>>
	// åˆå§‹åŒ–ç©å®¶è£…å¤‡
	<<set $playerInventory = $char.initialItems.slice()>>
	
	// åˆå§‹åŒ–æ‰€æœ‰è§’è‰²çš„è£…å¤‡ï¼ˆåŒ…æ‹¬NPCï¼‰
	<<set $allCharactersItems = {}>>
	<<set $allCharactersItems["lixiang"] = $char.initialItems.slice()>>
	
	// åˆ›å»ºNPCåˆ—è¡¨ï¼ˆå…¶ä»–5ä¸ªè§’è‰²ï¼‰
	<<set $npcs = []>>
	<<set _charKeys = Object.keys($characters)>>
	<<for _i = 0; _i < _charKeys.length; _i++>>
		<<set _key = _charKeys[_i]>>
		<<set _char = $characters[_key]>>
		<<if _key neq "lixiang">>
			<<set $allCharactersItems[_key] = _char.initialItems.slice()>>
			<<set $npcs.push({
				id: _key,
				name: _char.name,
				title: _char.title,
				items: _char.initialItems.slice()
			})>>
		<</if>>
	<</for>>
	
	// é‡ç½®æ¸¸æˆçŠ¶æ€
	<<set $currentDay = 1>>
	<<set $goalCompleted = false>>
	<<set $exchangedToday = false>>
	<<set $exchangeHistory = []>>
	<<set $gameStarted = true>>
<</silently>>

<h2>è§’è‰²ç¡®è®¤</h2>

<div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<p><strong>ä½ é€‰æ‹©äº†ï¼š$char.name</strong> - $char.title</p>
	<p><em>$char.description</em></p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ ä½ çš„åˆå§‹è£…å¤‡ï¼š</h3>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li style="padding: 5px 0;">$playerInventory[_i]</li>
	<</for>>
	</ul>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ç›®æ ‡ï¼š</h3>
	<p style="font-size: 1.1em; font-weight: bold; color: #e65100;">$char.goal</p>
</div>

<p>æ¸¸æˆå°†åœ¨ä¸‰å¤©å†…è¿›è¡Œã€‚æ¯å¤©ç™½å¤©ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªå…¶ä»–è§’è‰²è¿›è¡Œè£…å¤‡äº¤æ¢ã€‚</p>

<p><em>æ³¨æ„ï¼šå·¦ä¾§çš„èƒŒåŒ…èœå•ä¼šå®æ—¶æ˜¾ç¤ºä½ å½“å‰çš„è£…å¤‡ï¼ŒåŒ…æ‹¬äº¤æ¢åçš„è£…å¤‡ã€‚</em></p>

[[å¼€å§‹ç¬¬ä¸€å¤©|DayStart]]

:: ConfirmWuzhizhe
<<set $selectedCharacter = "wuzhizhe">>
<<set $char = $characters.wuzhizhe>>

<<silently>>
	// åˆå§‹åŒ–ç©å®¶è£…å¤‡
	<<set $playerInventory = $char.initialItems.slice()>>
	
	// åˆå§‹åŒ–æ‰€æœ‰è§’è‰²çš„è£…å¤‡ï¼ˆåŒ…æ‹¬NPCï¼‰
	<<set $allCharactersItems = {}>>
	<<set $allCharactersItems["wuzhizhe"] = $char.initialItems.slice()>>
	
	// åˆ›å»ºNPCåˆ—è¡¨ï¼ˆå…¶ä»–5ä¸ªè§’è‰²ï¼‰
	<<set $npcs = []>>
	<<set _charKeys = Object.keys($characters)>>
	<<for _i = 0; _i < _charKeys.length; _i++>>
		<<set _key = _charKeys[_i]>>
		<<set _char = $characters[_key]>>
		<<if _key neq "wuzhizhe">>
			<<set $allCharactersItems[_key] = _char.initialItems.slice()>>
			<<set $npcs.push({
				id: _key,
				name: _char.name,
				title: _char.title,
				items: _char.initialItems.slice()
			})>>
		<</if>>
	<</for>>
	
	// é‡ç½®æ¸¸æˆçŠ¶æ€
	<<set $currentDay = 1>>
	<<set $goalCompleted = false>>
	<<set $exchangedToday = false>>
	<<set $exchangeHistory = []>>
	<<set $gameStarted = true>>
<</silently>>

<h2>è§’è‰²ç¡®è®¤</h2>

<div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<p><strong>ä½ é€‰æ‹©äº†ï¼š$char.name</strong> - $char.title</p>
	<p><em>$char.description</em></p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ ä½ çš„åˆå§‹è£…å¤‡ï¼š</h3>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li style="padding: 5px 0;">$playerInventory[_i]</li>
	<</for>>
	</ul>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ç›®æ ‡ï¼š</h3>
	<p style="font-size: 1.1em; font-weight: bold; color: #e65100;">$char.goal</p>
</div>

<p>æ¸¸æˆå°†åœ¨ä¸‰å¤©å†…è¿›è¡Œã€‚æ¯å¤©ç™½å¤©ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªå…¶ä»–è§’è‰²è¿›è¡Œè£…å¤‡äº¤æ¢ã€‚</p>

<p><em>æ³¨æ„ï¼šå·¦ä¾§çš„èƒŒåŒ…èœå•ä¼šå®æ—¶æ˜¾ç¤ºä½ å½“å‰çš„è£…å¤‡ï¼ŒåŒ…æ‹¬äº¤æ¢åçš„è£…å¤‡ã€‚</em></p>

[[å¼€å§‹ç¬¬ä¸€å¤©|DayStart]]

:: ConfirmWangweiguo
<<set $selectedCharacter = "wangweiguo">>
<<set $char = $characters.wangweiguo>>

<<silently>>
	// åˆå§‹åŒ–ç©å®¶è£…å¤‡
	<<set $playerInventory = $char.initialItems.slice()>>
	
	// åˆå§‹åŒ–æ‰€æœ‰è§’è‰²çš„è£…å¤‡ï¼ˆåŒ…æ‹¬NPCï¼‰
	<<set $allCharactersItems = {}>>
	<<set $allCharactersItems["wangweiguo"] = $char.initialItems.slice()>>
	
	// åˆ›å»ºNPCåˆ—è¡¨ï¼ˆå…¶ä»–5ä¸ªè§’è‰²ï¼‰
	<<set $npcs = []>>
	<<set _charKeys = Object.keys($characters)>>
	<<for _i = 0; _i < _charKeys.length; _i++>>
		<<set _key = _charKeys[_i]>>
		<<set _char = $characters[_key]>>
		<<if _key neq "wangweiguo">>
			<<set $allCharactersItems[_key] = _char.initialItems.slice()>>
			<<set $npcs.push({
				id: _key,
				name: _char.name,
				title: _char.title,
				items: _char.initialItems.slice()
			})>>
		<</if>>
	<</for>>
	
	// é‡ç½®æ¸¸æˆçŠ¶æ€
	<<set $currentDay = 1>>
	<<set $goalCompleted = false>>
	<<set $exchangedToday = false>>
	<<set $exchangeHistory = []>>
	<<set $gameStarted = true>>
<</silently>>

<h2>è§’è‰²ç¡®è®¤</h2>

<div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<p><strong>ä½ é€‰æ‹©äº†ï¼š$char.name</strong> - $char.title</p>
	<p><em>$char.description</em></p>
</div>

<div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ“¦ ä½ çš„åˆå§‹è£…å¤‡ï¼š</h3>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li style="padding: 5px 0;">$playerInventory[_i]</li>
	<</for>>
	</ul>
</div>

<div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0;">
	<h3>ğŸ¯ ä½ çš„ç›®æ ‡ï¼š</h3>
	<p style="font-size: 1.1em; font-weight: bold; color: #e65100;">$char.goal</p>
</div>

<p>æ¸¸æˆå°†åœ¨ä¸‰å¤©å†…è¿›è¡Œã€‚æ¯å¤©ç™½å¤©ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªå…¶ä»–è§’è‰²è¿›è¡Œè£…å¤‡äº¤æ¢ã€‚</p>

<p><em>æ³¨æ„ï¼šå·¦ä¾§çš„èƒŒåŒ…èœå•ä¼šå®æ—¶æ˜¾ç¤ºä½ å½“å‰çš„è£…å¤‡ï¼ŒåŒ…æ‹¬äº¤æ¢åçš„è£…å¤‡ã€‚</em></p>

[[å¼€å§‹ç¬¬ä¸€å¤©|DayStart]]

:: About
<h2>å…³äºæ¸¸æˆ</h2>

<p><strong>å¥‡ç¼˜è§’è‰²</strong>æ˜¯ä¸€ä¸ªåŸºäº Twine çš„äº¤äº’å¼æ–‡å­—å†’é™©æ¸¸æˆã€‚</p>

<p>åœ¨è¿™ä¸ªæ¸¸æˆä¸­ï¼Œä½ å°†æ‰®æ¼”çš‡å®«ä¸­çš„å…­ä¸ªè§’è‰²ä¹‹ä¸€ï¼Œåœ¨ä¸‰å¤©å†…å®Œæˆä½ çš„ç›®æ ‡ã€‚é€šè¿‡ä¸å…¶ä»–è§’è‰²äº¤æ¢è£…å¤‡ï¼Œä½ å¯ä»¥è·å¾—å®Œæˆç›®æ ‡æ‰€éœ€çš„ç‰©å“ã€‚</p>

<h3>æ¸¸æˆè§„åˆ™ï¼š</h3>
<ul>
	<li>æ¸¸æˆå…±ä¸‰å¤©ï¼Œæ¯å¤©æ˜¯ä¸€ä¸ªç« èŠ‚</li>
	<li>æ¯å¤©ç™½å¤©å¯ä»¥ä¸å…¶ä»–è§’è‰²äº¤æ¢ä¸€æ¬¡è£…å¤‡</li>
	<li>åœ¨ä¸‰å¤©å†…è¾¾æˆè§’è‰²ç›®æ ‡å³ä¸ºæˆåŠŸ</li>
	<li>ä¸‰å¤©åæœªè¾¾æˆç›®æ ‡åˆ™å¤±è´¥</li>
</ul>

[[è¿”å›|CharacterSelect]]

:: CheckGoal
<<set $char = $characters[$selectedCharacter]>>
<<set $goalCompleted = false>>

<<if $selectedCharacter eq "claudius">>
	// å…‹åŠ³ç‹„æ–¯ï¼ˆå›½ç‹ï¼‰ï¼šæ‰¾åˆ°å¹¶é˜»æ­¢é’ˆå¯¹ç‹ä½çš„é˜´è°‹
	// éœ€è¦ï¼šçç é€šå…³ä¿¡ç‰© + è‡³å°‘ä¸¤ä¸ªå…¶ä»–å…³é”®ç‰©å“ï¼ˆæ¥è‡ªå…¶ä»–è§’è‰²ï¼‰
	<<if $playerInventory.includes("çç é€šå…³ä¿¡ç‰©")>>
		<<set _keyItems = 0>>
		<<if $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("å‘¨æŠ¥")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°å›¾")>><<set _keyItems++>><</if>>
		<<if _keyItems gte 2>>
			<<set $goalCompleted = true>>
			<p style="color: green; font-weight: bold;">âœ“ ä½ æˆåŠŸæ‰¾åˆ°äº†é˜»æ­¢é˜´è°‹çš„å…³é”®çº¿ç´¢ï¼</p>
		<</if>>
	<</if>>
	
<<elseif $selectedCharacter eq "chengying">>
	// ç¨‹å©´ï¼ˆå¾¡åŒ»ï¼‰ï¼šæŸ¥æ˜å›½ç‹çš„ç—…å› å¹¶æ‰¾åˆ°è§£è¯
	// éœ€è¦ï¼šä¸­è‰è¯ + å®‰çœ è¯ + è‡³å°‘ä¸€ä¸ªå…¶ä»–çº¿ç´¢
	<<if $playerInventory.includes("ä¸­è‰è¯") and $playerInventory.includes("å®‰çœ è¯")>>
		<<if $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°") or $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾") or $playerInventory.includes("å‘¨æŠ¥")>>
			<<set $goalCompleted = true>>
			<p style="color: green; font-weight: bold;">âœ“ ä½ æˆåŠŸæ‰¾åˆ°äº†ç—…å› å’Œè§£è¯ï¼</p>
		<</if>>
	<</if>>
	
<<elseif $selectedCharacter eq "hefei">>
	// ä½•éï¼ˆæ½œæ°´æ•™ç»ƒï¼‰ï¼šè¯æ˜è‡ªå·±çš„çœŸå®èº«ä»½å¹¶å®Œæˆç§˜å¯†ä»»åŠ¡
	// éœ€è¦ï¼šæ½œæ°´è£…å¤‡ + è‡³å°‘ä¸¤ä¸ªå…¶ä»–å…³é”®ç‰©å“
	<<if $playerInventory.includes("æ½œæ°´è£…å¤‡")>>
		<<set _keyItems = 0>>
		<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("å‘¨æŠ¥")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çç é€šå…³ä¿¡ç‰©")>><<set _keyItems++>><</if>>
		<<if _keyItems gte 2>>
			<<set $goalCompleted = true>>
			<p style="color: green; font-weight: bold;">âœ“ ä½ æˆåŠŸè¯æ˜äº†èº«ä»½å¹¶å®Œæˆäº†ç§˜å¯†ä»»åŠ¡ï¼</p>
		<</if>>
	<</if>>
	
<<elseif $selectedCharacter eq "lixiang">>
	// ææƒ³ï¼ˆä¸‹æ°´é“å·¥ç¨‹è®¾è®¡å¸ˆï¼‰ï¼šå‘ç°å¹¶æ­éœ²ä¸‹æ°´é“ä¸­çš„ç§˜å¯†
	// éœ€è¦ï¼šåœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾ + è‡³å°‘ä¸¤ä¸ªå…¶ä»–çº¿ç´¢
	<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾")>>
		<<set _keyItems = 0>>
		<<if $playerInventory.includes("å‘¨æŠ¥")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾")>><<set _keyItems++>><</if>>
		<<if _keyItems gte 2>>
			<<set $goalCompleted = true>>
			<p style="color: green; font-weight: bold;">âœ“ ä½ æˆåŠŸå‘ç°å¹¶æ­éœ²äº†ä¸‹æ°´é“ä¸­çš„ç§˜å¯†ï¼</p>
		<</if>>
	<</if>>
	
<<elseif $selectedCharacter eq "wuzhizhe">>
	// å´æ™ºå“²ï¼ˆå»ºç­‘è®¾è®¡å¸ˆï¼‰ï¼šæ‰¾åˆ°å¸ˆå‚…ç•™ä¸‹çš„ç§˜å¯†å¹¶ä¿æŠ¤å®ƒ
	// éœ€è¦ï¼šçš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾ + å¯¼å¸ˆæ‰‹è®° + è‡³å°‘ä¸€ä¸ªå…¶ä»–ç‰©å“
	<<if $playerInventory.includes("çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾") and $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°")>>
		<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾") or $playerInventory.includes("å‘¨æŠ¥") or $playerInventory.includes("çš‡å®«åœ°å›¾")>>
			<<set $goalCompleted = true>>
			<p style="color: green; font-weight: bold;">âœ“ ä½ æˆåŠŸæ‰¾åˆ°å¹¶ä¿æŠ¤äº†å¸ˆå‚…ç•™ä¸‹çš„ç§˜å¯†ï¼</p>
		<</if>>
	<</if>>
	
<<elseif $selectedCharacter eq "wangweiguo">>
	// ç‹å«å›½ï¼ˆæ–½å·¥è¿è¾“é˜Ÿé˜Ÿé•¿ï¼‰ï¼šé˜»æ­¢éæ³•ç‰©èµ„çš„è¿è¾“å¹¶æ­éœ²çœŸç›¸
	// éœ€è¦ï¼šçš‡å®«åœ°å›¾ + å‘¨æŠ¥ + è‡³å°‘ä¸€ä¸ªå…¶ä»–çº¿ç´¢
	<<if $playerInventory.includes("çš‡å®«åœ°å›¾") and $playerInventory.includes("å‘¨æŠ¥")>>
		<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾") or $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°") or $playerInventory.includes("çç é€šå…³ä¿¡ç‰©")>>
			<<set $goalCompleted = true>>
			<p style="color: green; font-weight: bold;">âœ“ ä½ æˆåŠŸé˜»æ­¢äº†éæ³•è¿è¾“å¹¶æ­éœ²äº†çœŸç›¸ï¼</p>
		<</if>>
	<</if>>
<</if>>

<<if $goalCompleted>>
	<<if $currentDay eq 3>>
		[[æŸ¥çœ‹æˆåŠŸç»“å±€|GameSuccess]]
	<<else>>
		<p style="color: green; font-weight: bold;">æ­å–œï¼ä½ å·²ç»å®Œæˆäº†ç›®æ ‡ï¼ä½†æ¸¸æˆè¿˜ä¼šç»§ç»­ï¼Œä½ å¯ä»¥æ¢ç´¢æ›´å¤šå†…å®¹ã€‚</p>
		[[ç»“æŸç¬¬ $currentDay å¤©|EndDay]]
	<</if>>
<<elseif $currentDay eq 3>>
	[[æŸ¥çœ‹å¤±è´¥ç»“å±€|GameFailure]]
<<else>>
	<p style="color: #666;">ä½ è¿˜éœ€è¦æ›´å¤šçº¿ç´¢æ¥å®Œæˆç›®æ ‡ã€‚ç»§ç»­åŠªåŠ›ï¼</p>
	[[ç»“æŸç¬¬ $currentDay å¤©|EndDay]]
<</if>>

:: FinalCheck
<<set $char = $characters[$selectedCharacter]>>
<<set $goalCompleted = false>>

<<if $selectedCharacter eq "claudius">>
	<<if $playerInventory.includes("çç é€šå…³ä¿¡ç‰©")>>
		<<set _keyItems = 0>>
		<<if $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("å‘¨æŠ¥")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°å›¾")>><<set _keyItems++>><</if>>
		<<if _keyItems gte 2>>
			<<set $goalCompleted = true>>
		<</if>>
	<</if>>
<<elseif $selectedCharacter eq "chengying">>
	<<if $playerInventory.includes("ä¸­è‰è¯") and $playerInventory.includes("å®‰çœ è¯")>>
		<<if $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°") or $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾") or $playerInventory.includes("å‘¨æŠ¥")>>
			<<set $goalCompleted = true>>
		<</if>>
	<</if>>
<<elseif $selectedCharacter eq "hefei">>
	<<if $playerInventory.includes("æ½œæ°´è£…å¤‡")>>
		<<set _keyItems = 0>>
		<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("å‘¨æŠ¥")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çç é€šå…³ä¿¡ç‰©")>><<set _keyItems++>><</if>>
		<<if _keyItems gte 2>>
			<<set $goalCompleted = true>>
		<</if>>
	<</if>>
<<elseif $selectedCharacter eq "lixiang">>
	<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾")>>
		<<set _keyItems = 0>>
		<<if $playerInventory.includes("å‘¨æŠ¥")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°å›¾")>><<set _keyItems++>><</if>>
		<<if $playerInventory.includes("çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾")>><<set _keyItems++>><</if>>
		<<if _keyItems gte 2>>
			<<set $goalCompleted = true>>
		<</if>>
	<</if>>
<<elseif $selectedCharacter eq "wuzhizhe">>
	<<if $playerInventory.includes("çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾") and $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°")>>
		<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾") or $playerInventory.includes("å‘¨æŠ¥") or $playerInventory.includes("çš‡å®«åœ°å›¾")>>
			<<set $goalCompleted = true>>
		<</if>>
	<</if>>
<<elseif $selectedCharacter eq "wangweiguo">>
	<<if $playerInventory.includes("çš‡å®«åœ°å›¾") and $playerInventory.includes("å‘¨æŠ¥")>>
		<<if $playerInventory.includes("åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾") or $playerInventory.includes("å¯¼å¸ˆæ‰‹è®°") or $playerInventory.includes("çç é€šå…³ä¿¡ç‰©")>>
			<<set $goalCompleted = true>>
		<</if>>
	<</if>>
<</if>>

<<if $goalCompleted>>
	[[æˆåŠŸç»“å±€|GameSuccess]]
<<else>>
	[[å¤±è´¥ç»“å±€|GameFailure]]
<</if>>

:: GameSuccess
<h1 style="color: green; text-align: center;">ğŸ‰ æˆåŠŸï¼</h1>

<<set $char = $characters[$selectedCharacter]>>

<div style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0;">
	<h2>æ­å–œä½ ï¼Œ$char.nameï¼</h2>
	
	<p>ç»è¿‡ä¸‰å¤©çš„åŠªåŠ›ï¼Œä½ æˆåŠŸå®Œæˆäº†ä½ çš„ç›®æ ‡ï¼š</p>
	<p><strong>$char.goal</strong></p>
	
	<h3>ä½ çš„æœ€ç»ˆè£…å¤‡ï¼š</h3>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li>$playerInventory[_i]</li>
	<</for>>
	</ul>
	
	<h3>äº¤æ¢è®°å½•ï¼š</h3>
	<<if $exchangeHistory.length gt 0>>
		<ul>
		<<for _i = 0; _i < $exchangeHistory.length; _i++>>
			<li>ç¬¬ $exchangeHistory[_i].day å¤©ï¼šä¸ $exchangeHistory[_i].with äº¤æ¢äº† "$exchangeHistory[_i].myItem" â†” "$exchangeHistory[_i].npcItem"</li>
		<</for>>
		</ul>
	<<else>>
		<p>ä½ æ²¡æœ‰è¿›è¡Œä»»ä½•è£…å¤‡äº¤æ¢ã€‚</p>
	<</if>>
</div>

<p>ä½ çš„æ™ºæ…§å’Œç­–ç•¥å¸®åŠ©ä½ åœ¨ä¸‰å¤©å†…å®Œæˆäº†çœ‹ä¼¼ä¸å¯èƒ½çš„ä»»åŠ¡ã€‚çš‡å®«çš„ç§˜å¯†ç»ˆäºè¢«æ­å¼€ï¼ŒçœŸç›¸å¤§ç™½äºå¤©ä¸‹ã€‚</p>

[[é‡æ–°å¼€å§‹|CharacterSelect]]

:: GameFailure
<h1 style="color: red; text-align: center;">âŒ å¤±è´¥</h1>

<<set $char = $characters[$selectedCharacter]>>

<div style="background: #ffebee; padding: 20px; border-radius: 10px; margin: 20px 0;">
	<h2>å¾ˆé—æ†¾ï¼Œ$char.name</h2>
	
	<p>ä¸‰å¤©è¿‡å»äº†ï¼Œä½ æœªèƒ½å®Œæˆä½ çš„ç›®æ ‡ï¼š</p>
	<p><strong>$char.goal</strong></p>
	
	<h3>ä½ çš„æœ€ç»ˆè£…å¤‡ï¼š</h3>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li>$playerInventory[_i]</li>
	<</for>>
	</ul>
	
	<h3>äº¤æ¢è®°å½•ï¼š</h3>
	<<if $exchangeHistory.length gt 0>>
		<ul>
		<<for _i = 0; _i < $exchangeHistory.length; _i++>>
			<li>ç¬¬ $exchangeHistory[_i].day å¤©ï¼šä¸ $exchangeHistory[_i].with äº¤æ¢äº† "$exchangeHistory[_i].myItem" â†” "$exchangeHistory[_i].npcItem"</li>
		<</for>>
		</ul>
	<<else>>
		<p>ä½ æ²¡æœ‰è¿›è¡Œä»»ä½•è£…å¤‡äº¤æ¢ã€‚</p>
	<</if>>
</div>

<p>æ—¶é—´ä¸ç­‰äººï¼Œæœºä¼šç¨çºµå³é€ã€‚ä¹Ÿè®¸ä¸‹ä¸€æ¬¡ï¼Œä½ éœ€è¦æ›´ä»”ç»†åœ°è§„åˆ’ä½ çš„ç­–ç•¥ï¼Œæ›´è°¨æ…åœ°é€‰æ‹©äº¤æ¢çš„å¯¹è±¡ã€‚</p>

<p>ä½†ä¸è¦ç°å¿ƒï¼Œæ¯ä¸€æ¬¡å°è¯•éƒ½æ˜¯ä¸€æ¬¡å­¦ä¹ çš„æœºä¼šã€‚é‡æ–°å¼€å§‹ï¼Œä¹Ÿè®¸ä½ èƒ½æ‰¾åˆ°æ›´å¥½çš„æ–¹æ³•ã€‚</p>

[[é‡æ–°å¼€å§‹|CharacterSelect]]

:: DayStart
<<set $exchangedToday = false>>

<h2>ç¬¬ $currentDay å¤©</h2>

<<set $char = $characters[$selectedCharacter]>>

<div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin: 20px 0;">
	<h3>è§’è‰²ä¿¡æ¯</h3>
	<p><strong>è§’è‰²ï¼š</strong>$char.name - $char.title</p>
	<p><strong>å½“å‰è£…å¤‡ï¼š</strong></p>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li>$playerInventory[_i]</li>
	<</for>>
	</ul>
	<p><strong>ç›®æ ‡ï¼š</strong>$char.goal</p>
</div>

<<if $currentDay eq 1>>
	<p>æ¸…æ™¨çš„é˜³å…‰é€è¿‡çš‡å®«çš„çª—æˆ·æ´’è¿›æ¥ã€‚è¿™æ˜¯ä½ åœ¨çš‡å®«çš„ç¬¬ä¸€å¤©ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€ä¸€ç§è¯´ä¸å‡ºçš„ç´§å¼ æ„Ÿã€‚</p>
	
	<p>ä½ ä½œä¸º $char.nameï¼Œæ·±çŸ¥è‡ªå·±è‚©è´Ÿç€é‡è¦çš„ä½¿å‘½ã€‚ä»Šå¤©ï¼Œä½ éœ€è¦å¼€å§‹è¡ŒåŠ¨ï¼Œå¯»æ‰¾å®Œæˆç›®æ ‡æ‰€éœ€çš„çº¿ç´¢å’Œç‰©å“ã€‚</p>
	
	<p>åœ¨çš‡å®«ä¸­ï¼Œä½ é‡åˆ°äº†å…¶ä»–å‡ ä½å…³é”®äººç‰©ã€‚ä¹Ÿè®¸ï¼Œé€šè¿‡ä¸ä»–ä»¬äº¤æ¢è£…å¤‡ï¼Œä½ èƒ½è·å¾—ä¸€äº›æœ‰ç”¨çš„ä¸œè¥¿...</p>
	
	[[è¿›è¡Œè£…å¤‡äº¤æ¢|DayExchange]]
	
<<elseif $currentDay eq 2>>
	<p>ç¬¬äºŒå¤©ï¼Œçš‡å®«ä¸­çš„æ°”æ°›å˜å¾—æ›´åŠ ç´§å¼ ã€‚ä½ æ„Ÿè§‰åˆ°æ—¶é—´åœ¨æµé€ï¼Œå¿…é¡»åŠ å¿«è¡ŒåŠ¨çš„æ­¥ä¼ã€‚</p>
	
	<p>æ˜¨å¤©çš„ä¸€äº›å‘ç°è®©ä½ å¯¹ç›®æ ‡æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ã€‚ä»Šå¤©ï¼Œä½ éœ€è¦æ›´åŠ è°¨æ…åœ°é€‰æ‹©äº¤æ¢å¯¹è±¡ã€‚</p>
	
	[[è¿›è¡Œè£…å¤‡äº¤æ¢|DayExchange]]
	
<<elseif $currentDay eq 3>>
	<p>ç¬¬ä¸‰å¤©ï¼Œè¿™æ˜¯æœ€åçš„æœºä¼šäº†ã€‚æˆè´¥åœ¨æ­¤ä¸€ä¸¾ã€‚</p>
	
	<p>ä½ å›é¡¾äº†å‰ä¸¤å¤©çš„ç»å†ï¼Œç°åœ¨å¿…é¡»åšå‡ºæœ€åçš„å†³å®šã€‚è¿™æ˜¯å®Œæˆç›®æ ‡çš„æœ€åæœºä¼šã€‚</p>
	
	[[è¿›è¡Œè£…å¤‡äº¤æ¢|DayExchange]]
<</if>>

:: DayExchange
<<if not $exchangedToday>>
	<h3>è£…å¤‡äº¤æ¢</h3>
	<p>ä»Šå¤©ä½ è¿˜æ²¡æœ‰è¿›è¡Œè£…å¤‡äº¤æ¢ã€‚é€‰æ‹©ä¸€ä¸ªè§’è‰²è¿›è¡Œäº¤æ¢ï¼š</p>
	
	<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
		<<for _i = 0; _i < $npcs.length; _i++>>
			<<set _npc = $npcs[_i]>>
			<div style="border: 1px solid #ccc; padding: 10px; border-radius: 5px;">
				<h4>$npc.name - $npc.title</h4>
				<p><strong>å½“å‰è£…å¤‡ï¼š</strong></p>
				<ul>
				<<for _j = 0; _j < $allCharactersItems[$npc.id].length; _j++>>
					<li>$allCharactersItems[$npc.id][_j]</li>
				<</for>>
				</ul>
				[[ä¸ $npc.name äº¤æ¢|ExchangeWith:$npc.id]]
			</div>
		<</for>>
	</div>
	
	[[è·³è¿‡äº¤æ¢ï¼Œç»§ç»­|DayContinue]]
<<else>>
	<p>ä½ ä»Šå¤©å·²ç»è¿›è¡Œè¿‡è£…å¤‡äº¤æ¢äº†ã€‚</p>
	[[ç»§ç»­|DayContinue]]
<</if>>

:: ExchangeWith[npcId]
<<set _npc = $npcs.find(function(n) { return n.id === npcId; })>>

<<if not _npc>>
	å‡ºé”™äº†ï¼Œæ‰¾ä¸åˆ°è¯¥è§’è‰²ã€‚
	[[è¿”å›|DayExchange]]
<<elseif $exchangedToday>>
	ä½ ä»Šå¤©å·²ç»è¿›è¡Œè¿‡è£…å¤‡äº¤æ¢äº†ã€‚
	[[è¿”å›|DayExchange]]
<<else>>
	<h3>ä¸ $npc.name äº¤æ¢è£…å¤‡</h3>
	
	<p>ä½ å½“å‰æ‹¥æœ‰çš„è£…å¤‡ï¼š</p>
	<ul>
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<li>$playerInventory[_i]</li>
	<</for>>
	</ul>
	
	<p>$npc.name æ‹¥æœ‰çš„è£…å¤‡ï¼š</p>
	<ul>
	<<for _j = 0; _j < $allCharactersItems[npcId].length; _j++>>
		<li>$allCharactersItems[npcId][_j]</li>
	<</for>>
	</ul>
	
	<p>é€‰æ‹©ä½ è¦äº¤æ¢çš„è£…å¤‡ï¼š</p>
	
	<<for _i = 0; _i < $playerInventory.length; _i++>>
		<<set _item = $playerInventory[_i]>>
		<div style="margin: 10px 0;">
			<p><strong>ç”¨ "$_item" äº¤æ¢ï¼š</strong></p>
			<<for _j = 0; _j < $allCharactersItems[npcId].length; _j++>>
				<<set _npcItem = $allCharactersItems[npcId][_j]>>
				[[$_item â†” $_npcItem|DoExchange:$_item:$_npcItem:$npcId]]
			<</for>>
		</div>
	<</for>>
	
	[[å–æ¶ˆ|DayExchange]]
<</if>>

:: DoExchange[myItem:npcItem:npcId]
<<set _npc = $npcs.find(function(n) { return n.id === npcId; })>>

<<if $exchangedToday>>
	ä½ ä»Šå¤©å·²ç»è¿›è¡Œè¿‡è£…å¤‡äº¤æ¢äº†ã€‚
	[[è¿”å›|DayExchange]]
<<elseif not $playerInventory.includes(myItem)>>
	ä½ æ²¡æœ‰è¿™ä¸ªè£…å¤‡ã€‚
	[[è¿”å›|ExchangeWith:$npcId]]
<<elseif not $allCharactersItems[npcId].includes(npcItem)>>
	$npc.name æ²¡æœ‰è¿™ä¸ªè£…å¤‡ã€‚
	[[è¿”å›|ExchangeWith:$npcId]]
<</if>>

// æ‰§è¡Œäº¤æ¢
<<set _myIndex = $playerInventory.indexOf(myItem)>>
<<set _npcIndex = $allCharactersItems[npcId].indexOf(npcItem)>>

<<set $playerInventory[_myIndex] = npcItem>>
<<set $allCharactersItems[npcId][_npcIndex] = myItem>>

// æ›´æ–°NPCçš„itemsæ•°ç»„ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
<<set _npc.items[_npcIndex] = myItem>>

// è®°å½•äº¤æ¢
<<set $exchangedToday = true>>
<<set $exchangeHistory.push({
	day: $currentDay,
	with: _npc.name,
	myItem: myItem,
	npcItem: npcItem
})>>

<h3>äº¤æ¢æˆåŠŸï¼</h3>

<p>ä½ ç”¨ <strong>$myItem</strong> ä¸ $npc.name äº¤æ¢äº† <strong>$npcItem</strong>ã€‚</p>

<p>ä½ ç°åœ¨çš„è£…å¤‡ï¼š</p>
<ul>
<<for _i = 0; _i < $playerInventory.length; _i++>>
	<li>$playerInventory[_i]</li>
<</for>>
</ul>

[[ç»§ç»­|DayContinue]]

:: DayContinue
<h3>ç»§ç»­ç¬¬ $currentDay å¤©</h3>

<<if $currentDay eq 1>>
	<p>äº¤æ¢å®Œè£…å¤‡åï¼Œä½ å¼€å§‹åœ¨çš‡å®«ä¸­æ¢ç´¢ã€‚ä»Šå¤©çš„ä¸»è¦ä»»åŠ¡æ˜¯äº†è§£æƒ…å†µï¼Œæ”¶é›†ä¿¡æ¯ã€‚</p>
	
	<p>ä½ èµ°éäº†çš‡å®«çš„å„ä¸ªè§’è½ï¼Œä¸ä¸åŒçš„äººäº¤è°ˆï¼Œè§‚å¯Ÿç€å‘¨å›´çš„ä¸€åˆ‡ã€‚ä¸€äº›çº¿ç´¢å¼€å§‹æµ®ç°...</p>
	
	[[æ£€æŸ¥ç›®æ ‡|CheckGoal]]
	
<<elseif $currentDay eq 2>>
	<p>ç¬¬äºŒå¤©ï¼Œä½ ç»§ç»­æ·±å…¥è°ƒæŸ¥ã€‚æ ¹æ®æ˜¨å¤©çš„å‘ç°ï¼Œä½ æœ‰äº†æ›´æ˜ç¡®çš„æ–¹å‘ã€‚</p>
	
	<p>ä½ å¼€å§‹å°†çº¿ç´¢ä¸²è”èµ·æ¥ï¼ŒçœŸç›¸é€æ¸æµ®å‡ºæ°´é¢...</p>
	
	[[æ£€æŸ¥ç›®æ ‡|CheckGoal]]
	
<<elseif $currentDay eq 3>>
	<p>ç¬¬ä¸‰å¤©ï¼Œè¿™æ˜¯æœ€åçš„æœºä¼šã€‚ä½ æ•´åˆäº†æ‰€æœ‰çš„çº¿ç´¢å’Œè£…å¤‡ï¼Œå‡†å¤‡é‡‡å–æœ€åçš„è¡ŒåŠ¨ã€‚</p>
	
	<p>æˆè´¥åœ¨æ­¤ä¸€ä¸¾...</p>
	
	[[æ£€æŸ¥ç›®æ ‡|CheckGoal]]
<</if>>

:: EndDay
<<set _oldDay = $currentDay>>
<<set $currentDay++>>

<<if $currentDay le 3>>
	<p>ç¬¬ _oldDay å¤©ç»“æŸäº†ã€‚ä½ å›åˆ°æˆ¿é—´ä¼‘æ¯ï¼Œå‡†å¤‡è¿æ¥æ–°çš„ä¸€å¤©ã€‚</p>
	
	[[è¿›å…¥ç¬¬ $currentDay å¤©|DayStart]]
<<else>>
	<p>ä¸‰å¤©çš„æ—¶é—´å·²ç»è¿‡å»äº†...</p>
	[[æœ€ç»ˆæ£€æŸ¥|FinalCheck]]
<</if>>

// ç¬¬äºŒç« å†…å®¹å·²åœ¨ chapter-1.twee ä¸­é€šè¿‡ DayStart å’Œæ¡ä»¶åˆ¤æ–­å®ç°
// æ­¤æ–‡ä»¶ä¿ç•™ä½œä¸ºå¤‡ç”¨æˆ–æ‰©å±•å†…å®¹

// ç¬¬ä¸‰ç« å†…å®¹å·²åœ¨ chapter-1.twee ä¸­é€šè¿‡ DayStart å’Œæ¡ä»¶åˆ¤æ–­å®ç°
// æ­¤æ–‡ä»¶ä¿ç•™ä½œä¸ºå¤‡ç”¨æˆ–æ‰©å±•å†…å®¹

