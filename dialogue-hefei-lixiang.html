<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½•éæ‹œè®¿ææƒ³</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯æŒ‰é’® -->
    <div id="mobile-info-btn" style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1000; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ“¦</div>

    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿ -->
    <div id="mobile-info-panel" style="display: none; position: fixed; bottom: 80px; right: 20px; width: 250px; max-height: 300px; background: rgba(255, 255, 255, 0.98); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); z-index: 1000; padding: 15px; overflow-y: auto;">
        <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
    </div>

    <!-- é®ç½©å±‚ -->
    <div id="mobile-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>

    <!-- å¯¹è¯å†…å®¹åŒºåŸŸ -->
    <div id="dialogue-content">
        <div class="page-container">
            <h2>ä½•éæ‹œè®¿ææƒ³</h2>

            <div class="dialogue-container">
                <div class="dialogue-scene">
                    <p class="scene-description">ä½ ç«‹å³åŠ¨èº«å‰å¾€æ¡ˆå‘å¤„ï¼Œä½ çŸ¥é“ææƒ³ä¸€å®šä¼šæ¥æ­¤å¤„æŸ¥çœ‹ä¸‹æ°´é“ï¼Œè€Œè¿™é‡Œå¯èƒ½è—ç€ä¸€äº›ç§˜å¯†ã€‚</p>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p>å…‹åŠ³ç‹„æ–¯:ç‹å«å›½ï¼Œå·¥ç¨‹è¿›å±•å¦‚ä½•ï¼Ÿ</p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p>ç‹å«å›½:é™›ä¸‹ï¼Œä¸€åˆ‡æŒ‰è®¡åˆ’è¿›è¡Œï¼Œé¢„è®¡å¹´åº•å®Œå·¥ã€‚</p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p>å…‹åŠ³ç‹„æ–¯:å®«ä¸­å‘ç°å°¸ä½“çš„äº‹ï¼Œä½ æ€ä¹ˆçœ‹ï¼Ÿ</p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p>ç‹å«å›½:é™›ä¸‹ï¼Œæˆ‘æ­£åœ¨è°ƒæŸ¥ç°åœºã€‚é‚£å°¸ä½“ç¡®å®æ˜¯åœ¨ä¸‹æ°´é“é™„è¿‘å‘ç°çš„ï¼Œä½†ä¸æ˜¯æˆ‘ä»¬å·¥åœ°çš„è´£ä»»ã€‚æ‚¨å¯ä»¥é—®é—®å´æ™ºå“²ï¼Œä»–å¯¹å®«æ®¿ç»“æ„æœ€äº†ï¿½</p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p>ï¿½ã€‚</p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p></p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p>å…‹åŠ³ç‹„æ–¯:å¥½ï¼Œæœ¬ç‹çŸ¥é“äº†ã€‚ï¿½</p>
                    </div>
                </div>
                <div class="dialogue-section">
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ”§</div>
                        <div class="character-name">ææƒ³</div>
                    </div>

                    <div class="dialogue-bubble host-bubble">
                        <p>ç»­å·¥ä½œï¼Œæ³¨æ„å®‰å…¨ã€‚</p>
                    </div>
                </div>

                <div class="dialogue-actions">
                    <button class="action-btn primary large" onclick="proceedToExchange()">
                        ç»§ç»­è°ƒæŸ¥ - äº¤æ¢ç‰©å“
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="assets/js/characters.js"></script>
    <script src="assets/js/items.js"></script>
    <script>
        // ä»URLå‚æ•°è·å–è§’è‰²ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const currentCharacter = urlParams.get('character') || 'hefei';
        const targetCharacter = urlParams.get('target') || 'lixiang';
        const day = urlParams.get('day') || '1';

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            selectedCharacter: currentCharacter,
            currentDay: parseInt(day),
            gameStarted: true,
            playerInventory: [],
            allCharactersItems: {},
            npcs: []
        };

        // åˆå§‹åŒ–è§’è‰²æ•°æ®
        function initCharacterData() {
            const char = window.characters[currentCharacter];
            gameState.playerInventory = [...char.initialItems];
            updateMobileInfoPanel();
        }

        // ç»§ç»­åˆ°äº¤æ¢ç‰©å“
        function proceedToExchange() {
            // è·³è½¬åˆ°è£…å¤‡äº¤æ¢é¡µé¢
            const exchangeUrl = `game.html?character=${currentCharacter}&day=${day}&from=dialogue`;
            window.location.href = exchangeUrl;
        }

        // æ›´æ–°ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function updateMobileInfoPanel() {
            const isMobile = window.innerWidth <= 768;

            // æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.style.display = (isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            if (!isMobile || !gameState.gameStarted) {
                hideMobileInfoPanel();
                return;
            }

            const char = window.characters[gameState.selectedCharacter];
            const panel = document.getElementById('mobile-info-panel');

            if (panel) {
                panel.innerHTML = `
                    <div class="character-info">
                        <strong>è§’è‰²ï¼š</strong>
                        <span>${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4>ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="mobile-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${item}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} å¤©</strong>
                    </div>
                `;
            }
        }

        // åˆ‡æ¢ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function toggleMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            if (panel) {
                const isVisible = panel.style.display === 'block';
                if (isVisible) {
                    hideMobileInfoPanel();
                } else {
                    showMobileInfoPanel();
                }
            }
        }

        // æ˜¾ç¤ºç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function showMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            const overlay = document.getElementById('mobile-overlay');

            if (panel && overlay) {
                panel.style.display = 'block';
                overlay.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        // éšè—ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function hideMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            const overlay = document.getElementById('mobile-overlay');

            if (panel && overlay) {
                panel.style.display = 'none';
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // äº‹ä»¶ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            initCharacterData();

            // ç§»åŠ¨ç«¯æŒ‰é’®äº‹ä»¶
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.addEventListener('click', toggleMobileInfoPanel);
            }

            // é®ç½©å±‚ç‚¹å‡»å…³é—­
            document.addEventListener('click', function(e) {
                if (e.target.id === 'mobile-overlay') {
                    hideMobileInfoPanel();
                }
            });

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 27) {
                    hideMobileInfoPanel();
                }
            });
        });
    </script>
</body>
</html>
