<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‡ç¼˜48 - ç«æŸ´çš„æŠ‰æ‹©</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯æŒ‰é’® -->
    <div id="mobile-info-btn" style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1000; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ“¦</div>

    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿ -->
    <div id="mobile-info-panel" style="display: none; position: fixed; bottom: 80px; right: 20px; width: 250px; max-height: 300px; background: rgba(255, 255, 255, 0.98); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); z-index: 1000; padding: 15px; overflow-y: auto;">
        <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
    </div>

    <!-- ç”µè„‘ç«¯ä¾§è¾¹æ  -->
    <div id="desktop-sidebar" style="display: none; position: fixed; top: 20px; right: 20px; width: 280px; max-height: 80vh; background: rgba(255, 255, 255, 0.95); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); z-index: 1000; padding: 20px; overflow-y: auto; border: 1px solid #e0e0e0;">
        <h4 style="margin: 0 0 15px 0; color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 8px;">è§’è‰²ä¿¡æ¯</h4>
        <div id="desktop-sidebar-content">
            <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
        </div>
    </div>

    <!-- é®ç½©å±‚ -->
    <div id="mobile-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>

    <!-- ç”µè„‘ç«¯ä¿¡æ¯æŒ‰é’® -->
    <div id="desktop-info-btn" style="position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 999; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ“¦</div>

    <!-- å†³ç­–å†…å®¹åŒºåŸŸ -->
    <div id="decision-content">
        <div class="decision-container">
            <h2>ç«æŸ´çš„æŠ‰æ‹©</h2>

            <div class="decision-text">
                <p>ä½ åªæœ‰æœ€åä¸€æ ¹ç«æŸ´äº†ã€‚ä½ å†³å®šï¼š</p>
            </div>

            <div class="decision-options" id="decision-options">
                <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
            </div>
        </div>
    </div>

    <style>
        /* ä¼˜åŒ–å†³ç­–é¡µé¢æ ·å¼ */
        html, body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
        }

        body {
            display: block;
            overflow-y: auto;
            padding: 20px;
        }

        #decision-content {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 40px);
            width: 100%;
        }

        .decision-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 3em;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            width: 100%;
            max-width: 800px;
            box-sizing: border-box;
        }

        .decision-container h2 {
            margin-top: 0;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
            font-size: 2em;
        }

        .decision-text {
            margin: 2em 0;
            font-size: 1.2em;
            color: #333;
            line-height: 1.6;
        }

        .decision-options {
            display: flex;
            flex-direction: column;
            gap: 1em;
            margin-top: 2em;
            align-items: center;
        }

        .decision-option {
            width: 100%;
            max-width: 400px;
            padding: 1.2em;
            font-size: 1.1em;
            box-sizing: border-box;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            #decision-content {
                min-height: calc(100vh - 20px);
            }

            .decision-container {
                padding: 2em 1.5em;
            }

            .decision-container h2 {
                font-size: 1.5em;
            }

            .decision-text {
                font-size: 1.1em;
                margin: 1.5em 0;
            }

            .decision-options {
                margin-top: 1.5em;
            }
        }

        /* ç¡®ä¿èƒŒæ™¯è¦†ç›–æ•´ä¸ªå±å¹• */
        body {
            background-attachment: fixed;
            background-size: cover;
        }

        /* ç¡®ä¿èƒŒåŒ…æŒ‰é’®å¯è§ */
        #mobile-info-btn, #desktop-info-btn {
            position: fixed !important;
            z-index: 1000 !important;
        }
    </style>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="assets/js/characters.js"></script>
    <script src="assets/js/items.js"></script>
    <script src="assets/js/itemStories.js"></script>
    <script src="assets/js/backpack-improvements.js"></script>
    <script src="assets/js/item-details.js"></script>
    <script>
        // ä»URLå‚æ•°è·å–ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const currentCharacter = urlParams.get('character') || 'claudius';
        const day = urlParams.get('day') || '4';
        const from = urlParams.get('from') || 'story';

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            selectedCharacter: currentCharacter,
            currentDay: parseInt(day),
            gameStarted: true,
            playerInventory: [],
            allCharactersItems: {},
            npcs: []
        };

        // ä»localStorageåŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const savedState = localStorage.getItem('qiyuanGameState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                gameState = { ...gameState, ...parsedState };
            }
        }

        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        function saveGameState() {
            localStorage.setItem('qiyuanGameState', JSON.stringify(gameState));
        }

        // ç‰©å“åˆ—è¡¨ï¼ˆä¸ice-reveal.htmlä¸­çš„è§„åˆ™ä¸€è‡´ï¼‰
        const iceItems = [
            {
                excludeCharacter: 'claudius',
                itemKey: 'half-piece-curtain',
                itemName: 'åŠå—çª—å¸˜å¸ƒ',
                description: 'å’Œå…‹åŠ³ç‹„æ–¯çš„è¢å­çš„æè´¨ä¸€æ¨¡ä¸€æ ·ï¼Œä¸Šé¢ç”šè‡³è¿˜æœ‰æŒ‚çª—å¸˜ç”¨çš„é’©å­ã€‚ä½ å¿ƒç”Ÿç–‘æƒ‘ï¼Œéš¾é“å¾ç‹é»„è¢åŠ èº«çš„æ—¶å€™è¿˜æœ‰äººæ•¢ç”¨çª—å¸˜å¸ƒæˆå¼„ä»–ï¼Ÿä½ éƒ½èƒ½çœ‹å‡ºæ¥ï¼Œå…‹åŠ³ç‹„æ–¯ä¸€å®šä¹Ÿèƒ½çŸ¥é“ã€‚éš¾é“è¯´â€¦è¿™â€œé»„è¢â€çœŸçš„å°±æ˜¯çª—å¸˜å¸ƒï¼Ÿ'
            },
            {
                excludeCharacter: 'chengying',
                itemKey: 'scratcher',
                itemName: 'ç—’ç—’æŒ ',
                description: 'è°è¦ç”¨ç—’ç—’æŒ å‘¢ï¼Ÿä½ æƒ³èµ·äº†ä¸€ä¸ªäººï¼Œä¸çŸ¥ä¸ºä½•ï¼Œä»–é‚£ç™½è‰²å°è¢å­çš„èƒ³è‚¢çªä¸‹å¼€äº†ä¸¤ä¸ªæ´ï¼Œè°çœ‹äº†ä¸æƒ³æ‹¿ç—’ç—’æŒ æŒ ä»–å‘¢ï¼Ÿ'
            },
            {
                excludeCharacter: 'hefei',
                itemKey: 'letter',
                itemName: 'ä¿¡å°',
                description: 'é‡Œé¢æœ‰ä¸€å¼ æµ·é²œè‡ªåŠ©é¤åˆ¸ï¼Œè¿˜æœ‰ä¸€å¼ è´ºå¡ï¼Œä¸Šé¢å†™ç€â€œè€å…¬ï¼Œæˆ‘ä¸è¦åƒç‰›æ’ï¼Œæˆ‘è¦åƒæµ·é²œã€‚ä»Šæ™šï¼Œè®©æˆ‘ä»¬ä¸€èµ·å–é†‰è¯¶è¯¶è¯¶è¯¶ï¼â€ æ¡ˆå‘åè¿™é‡Œè¢«ä»”ç»†æ£€æŸ¥è¿‡ï¼Œè¿™ä¸ªä¿¡å°åº”è¯¥æ˜¯æ˜¨æ™šæœ‰äººä¸å°å¿ƒæ‰åœ¨è¿™é‡Œï¼Œåˆç»“äº†éœœæ‰å˜æˆçš„å†°å—ã€‚è¿™é‡Œè°æœ‰è€å©†è¿˜ä¼šå»è‡ªåŠ©é¤å…ï¼Ÿä¸å¯¹ï¼Œè¿‡æœŸæ—¥æœŸæ˜¯å‡ å¹´å‰â€¦'
            },
            {
                excludeCharacter: 'wangweiguo',
                itemKey: 'picture',
                itemName: 'è€ç…§ç‰‡',
                description: 'ç…§ç‰‡ä¸Šèµ«ç„¶æ˜¯è¿è¾“é˜Ÿé˜Ÿé•¿ç‹å«å›½ï¼å¯æ˜¯å¥‡æ€ªï¼Œä»–çš„å˜´å·´å¾®å¾®å¼ å¼€ã€çœ‰å¤´ç´§è¹™ï¼Œçœ¼ç›å´è¢«ä¸€å—çº¢å¸ƒé®ç›–çœ‹ä¸æ¸…ç¥æƒ…ã€‚ä»–ä»°ç€å¤´éœ²å‡ºè„–å­ï¼Œåƒæ˜¯è¢«ä»€ä¹ˆäººæŒŸæŒäº†ä¸€æ ·ï¼Ÿ'
            },
            {
                excludeCharacter: 'lixiang',
                itemKey: 'one-line-of-code',
                itemName: 'ä¸€è¡Œä»£ç ',
                description: 'ä»¤äººæƒ³ä¸åˆ°çš„æ˜¯ï¼Œå¯’å†°é‡Œé£˜å‡ºäº†ä¸€è¡Œä»£ç ï¼šâ€œçƒ«çƒ«çƒ«çƒ«çƒ«çƒ«çƒ«çƒ«çƒ«...â€ã€‚ä½ æ²‰é»˜äº†ï¼Œææƒ³æ˜¯è¿œå¤æ—¶ä»£çš„å·¥ç¨‹å¸ˆå—ï¼Ÿæ€ä¹ˆåšåˆ°æ€»å·¥äº†è¿˜æ ˆå†…å­˜ä¸çŸ¥é“åˆå§‹åŒ–'
            },
            {
                excludeCharacter: 'wuzhizhe',
                itemKey: 'primer',
                itemName: 'éš”ç¦»éœœ',
                description: 'ä½ çœ‹åˆ°äº†ä¸€åªç»ç’ƒæ¯ï¼Œæ¯å­ä¸Šè´´ç€â€œä»…ä¾›è§‚çœ‹â€ï¼Œé‡Œé¢æ˜¯ä¸€æ”¯éš”ç¦»éœœã€‚ä½ å¾€é‡Œä¸€çœ‹ï¼ŒåŸæ¥æ˜¯éƒ‘æ£‹å…ƒè€å¸ˆ2025å¹´å…¨æ–°å•æ›²ã€Šæ‚²ï¼ˆæ¯ï¼‰è§‚éš”ç¦»ã€‹ã€‚å·²å…¨å¹³å°ä¸Šçº¿ï¼ŒæœŸå¾…æ‚¨çš„æ”¶å¬ã€‚'
            }
        ];

        // éšæœºé€‰æ‹©ç‰©å“ï¼ˆä¸ice-reveal.htmlä¸­çš„è§„åˆ™ä¸€è‡´ï¼‰
        function getRandomIceItem() {
            // è¿‡æ»¤æ‰å½“å‰è§’è‰²å¯¹åº”çš„ç‰©å“
            const availableItems = iceItems.filter(item => item.excludeCharacter !== currentCharacter);
            
            // ä»å¯ç”¨ç‰©å“ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª
            const randomIndex = Math.floor(Math.random() * availableItems.length);
            return availableItems[randomIndex];
        }

        // æ˜¾ç¤ºå†³ç­–æŒ‰é’®
        function showDecisionButtons() {
            const optionsContainer = document.getElementById('decision-options');
            const hasIce = gameState.playerInventory.includes('ice');
            
            if (hasIce) {
                // æœ‰å¯’å†°ï¼Œæ˜¾ç¤ºä¸¤ä¸ªæŒ‰é’®
                optionsContainer.innerHTML = `
                    <button class="action-btn primary large decision-option" onclick="handleMatchDecision('heat')">
                        ç”¨å®ƒåŠ çƒ­å¯’å†°
                    </button>
                    <button class="action-btn secondary large decision-option" onclick="handleMatchDecision('light')">
                        ç›´æ¥åˆ’å¼€ç«æŸ´
                    </button>
                `;
            } else {
                // æ²¡æœ‰å¯’å†°ï¼Œåªæ˜¾ç¤ºç»§ç»­æŒ‰é’®
                optionsContainer.innerHTML = `
                    <button class="action-btn primary large decision-option" onclick="handleMatchDecision('continue')">
                        ç»§ç»­
                    </button>
                `;
            }
        }

        // å¤„ç†ç«æŸ´å†³ç­–
        function handleMatchDecision(choice) {
            // æ ¹æ®é€‰æ‹©è¿›è¡Œä¸åŒçš„å¤„ç†
            if (choice === 'heat') {
                // ç”¨ç«æŸ´åŠ çƒ­å¯’å†°çš„å¤„ç†
                
                // 1. ç§»é™¤èƒŒåŒ…ä¸­çš„å¯’å†°
                const iceIndex = gameState.playerInventory.indexOf('ice');
                if (iceIndex > -1) {
                    gameState.playerInventory.splice(iceIndex, 1);
                }
                
                // ç§»é™¤è§’è‰²ç‰©å“åˆ—è¡¨ä¸­çš„å¯’å†°
                if (gameState.allCharactersItems[gameState.selectedCharacter]) {
                    const charIceIndex = gameState.allCharactersItems[gameState.selectedCharacter].indexOf('ice');
                    if (charIceIndex > -1) {
                        gameState.allCharactersItems[gameState.selectedCharacter].splice(charIceIndex, 1);
                    }
                }
                
                // 2. ç”Ÿæˆéšæœºç‰©å“
                const randomItem = getRandomIceItem();
                
                // 3. å°†æ–°ç‰©å“æ·»åŠ åˆ°èƒŒåŒ…
                if (!gameState.playerInventory.includes(randomItem.itemKey)) {
                    gameState.playerInventory.push(randomItem.itemKey);
                    
                    // å°†ç‰©å“æ·»åŠ åˆ°å½“å‰è§’è‰²çš„ç‰©å“åˆ—è¡¨
                    if (!gameState.allCharactersItems[gameState.selectedCharacter]) {
                        gameState.allCharactersItems[gameState.selectedCharacter] = [];
                    }
                    if (!gameState.allCharactersItems[gameState.selectedCharacter].includes(randomItem.itemKey)) {
                        gameState.allCharactersItems[gameState.selectedCharacter].push(randomItem.itemKey);
                    }
                }
                
                // 4. ä¿å­˜çŠ¶æ€
                saveGameState();
                
                // 5. ç›´æ¥è·³è½¬åˆ°ç«æŸ´æ­ç§˜é¡µé¢ï¼Œä¸æ˜¾ç¤ºå¼¹å‡ºæ¡†
                window.location.href = `match-reveal.html?character=${currentCharacter}&day=${gameState.currentDay}&newItem=${randomItem.itemKey}`;
            } else if (choice === 'light') {
                // ç›´æ¥åˆ’å¼€ç«æŸ´çš„å¤„ç†
                // ä¿å­˜çŠ¶æ€
                saveGameState();
                
                // è·³è½¬åˆ°æ¢¦é­‡é¡µé¢
                window.location.href = `match-nightmare.html?character=${currentCharacter}&day=${gameState.currentDay}`;
            } else {
                // æ²¡æœ‰å¯’å†°ï¼Œç›´æ¥ç»§ç»­
                // ä¿å­˜çŠ¶æ€
                saveGameState();
                
                // è·³è½¬åˆ°æ¢¦é­‡é¡µé¢
                window.location.href = `match-nightmare.html?character=${currentCharacter}&day=${gameState.currentDay}`;
            }
        }

        // æ›´æ–°ä¿¡æ¯é¢æ¿ï¼ˆæ”¯æŒç§»åŠ¨ç«¯å’Œç”µè„‘ç«¯ï¼‰
        function updateInfoPanel() {
            const isMobile = window.innerWidth <= 768;

            // æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.style.display = (isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            // ç”µè„‘ç«¯æŒ‰é’®æ˜¾ç¤º
            const desktopBtn = document.getElementById('desktop-info-btn');
            if (desktopBtn) {
                desktopBtn.style.display = (!isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            if (!gameState.gameStarted) {
                hideMobileInfoPanel();
                hideDesktopSidebar();
                return;
            }

            // æ›´æ–°ç”µè„‘ç«¯ä¾§è¾¹æ å†…å®¹ï¼Œä½†ä¸è‡ªåŠ¨æ˜¾ç¤º
            if (!isMobile) {
                updateDesktopSidebarContent();
                return;
            }

            // æ›´æ–°ç§»åŠ¨ç«¯é¢æ¿å†…å®¹ï¼Œä½†ä¸è‡ªåŠ¨æ˜¾ç¤º
            const char = window.characters[gameState.selectedCharacter];
            const panel = document.getElementById('mobile-info-panel');

            if (panel) {
                panel.innerHTML = `
                    <div class="character-info">
                        <strong>è§’è‰²ï¼š</strong>
                        <span>${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4>ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="mobile-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${window.getItemDisplayName(item)}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} ç« </strong>
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºç‰©å“ç®€ä»‹æ¨¡æ€æ¡†
        function showItemDetail(itemKey) {
            const item = window.itemStories[itemKey];
            if (!item) return;

            // åˆ›å»ºæ¨¡æ€æ¡†
            let modal = document.getElementById('item-detail-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'item-detail-modal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 2000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    backdrop-filter: blur(5px);
                `;
                document.body.appendChild(modal);

                // å…³é—­æ¨¡æ€æ¡†çš„ç‚¹å‡»äº‹ä»¶
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        hideItemDetail();
                    }
                });
            }

            // æ¨¡æ€æ¡†å†…å®¹
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 15px;
                    padding: 2em;
                    max-width: 800px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                ">
                    <h3 style="margin-top: 0; color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 15px;">
                        ${item.name}
                    </h3>
                    <div style="margin: 1.5em 0;">
                        <strong style="color: #667eea;">æè¿°ï¼š</strong>
                        <p>${item.description}</p>
                    </div>
                    <div style="margin: 1.5em 0;">
                        <strong style="color: #667eea;">æ•…äº‹ï¼š</strong>
                        <p>${item.story}</p>
                    </div>
                    <button onclick="hideItemDetail()" style="
                        background: #667eea;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        font-size: 1em;
                        margin-top: 1em;
                    ">
                        å…³é—­
                    </button>
                </div>
            `;

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // éšè—ç‰©å“ç®€ä»‹æ¨¡æ€æ¡†
        function hideItemDetail() {
            const modal = document.getElementById('item-detail-modal');
            if (modal) {
                modal.style.display = 'none';
            }
            document.body.style.overflow = '';
        }

        // æ›´æ–°ç”µè„‘ç«¯ä¾§è¾¹æ å†…å®¹
        function updateDesktopSidebarContent() {
            const sidebar = document.getElementById('desktop-sidebar');
            const content = document.getElementById('desktop-sidebar-content');

            if (sidebar && content) {
                const char = window.characters[gameState.selectedCharacter];
                content.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>å½“å‰è§’è‰²ï¼š</strong><br>
                        <span style="color: #667eea; font-size: 16px;">${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4 style="margin: 15px 0 10px 0; color: #667eea; font-size: 14px;">ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="desktop-inventory">
                            ${gameState.playerInventory.length === 0 ?
                                '<div style="color: #999; font-style: italic; padding: 10px;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                                gameState.playerInventory.map(item =>
                                    `<button onclick="showItemDetail('${item}')" style="
                                        width: 100%;
                                        text-align: left;
                                        padding: 10px 12px;
                                        margin: 5px 0;
                                        background: #f8f9ff;
                                        border: 1px solid #e0e0e0;
                                        border-radius: 5px;
                                        border-left: 3px solid #667eea;
                                        cursor: pointer;
                                        transition: all 0.2s ease;
                                    ">
                                        ${window.getItemDisplayName(item)}
                                    </button>`
                                ).join('')
                            }
                        </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} ç« </strong>
                    </div>
                `;
            }
        }

        // æ˜¾ç¤ºç”µè„‘ç«¯ä¾§è¾¹æ 
        function showDesktopSidebar() {
            updateDesktopSidebarContent();
            const sidebar = document.getElementById('desktop-sidebar');
            if (sidebar) {
                sidebar.style.display = 'block';
            }
        }

        // éšè—ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function hideMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            const overlay = document.getElementById('mobile-overlay');

            if (panel && overlay) {
                panel.style.display = 'none';
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // åˆ‡æ¢ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function toggleMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            if (panel) {
                const isVisible = panel.style.display === 'block';
                if (isVisible) {
                    hideMobileInfoPanel();
                } else {
                    const char = window.characters[gameState.selectedCharacter];
                    panel.innerHTML = `
                        <div class="character-info">
                            <strong>è§’è‰²ï¼š</strong>
                            <span>${char.name}</span><br>
                            <small style="color: #666;">${char.title}</small>
                        </div>

                        <h4>ğŸ“¦ èƒŒåŒ…</h4>
                        <div id="mobile-inventory">
                            ${gameState.playerInventory.length === 0 ?
                                '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                                gameState.playerInventory.map(item =>
                                    `<button onclick="showItemDetail('${item}')" style="
                                        width: 100%;
                                        text-align: left;
                                        padding: 10px 12px;
                                        margin: 5px 0;
                                        background: #f5f5f5;
                                        border: 1px solid #e0e0e0;
                                        border-radius: 5px;
                                        cursor: pointer;
                                        transition: all 0.2s ease;
                                    ">
                                        ${window.getItemDisplayName(item)}
                                    </button>`
                                ).join('')
                            }
                        </div>

                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                            <strong>ç¬¬ ${gameState.currentDay} ç« </strong>
                        </div>
                    `;
                    panel.style.display = 'block';
                    document.getElementById('mobile-overlay').style.display = 'block';
                    document.body.style.overflow = 'hidden';
                }
            }
        }

        // åˆ‡æ¢ç”µè„‘ç«¯ä¾§è¾¹æ 
        function toggleDesktopSidebar() {
            const sidebar = document.getElementById('desktop-sidebar');
            if (sidebar) {
                const isVisible = sidebar.style.display === 'block';
                if (isVisible) {
                    hideDesktopSidebar();
                } else {
                    showDesktopSidebar();
                }
            }
        }

        // éšè—ç”µè„‘ç«¯ä¾§è¾¹æ 
        function hideDesktopSidebar() {
            const sidebar = document.getElementById('desktop-sidebar');
            if (sidebar) {
                sidebar.style.display = 'none';
            }
        }

        // äº‹ä»¶ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            updateInfoPanel();
            
            // æ˜¾ç¤ºå†³ç­–æŒ‰é’®
            showDecisionButtons();

            // ç§»åŠ¨ç«¯æŒ‰é’®äº‹ä»¶
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.addEventListener('click', toggleMobileInfoPanel);
            }

            // ç”µè„‘ç«¯æŒ‰é’®äº‹ä»¶
            const desktopBtn = document.getElementById('desktop-info-btn');
            if (desktopBtn) {
                desktopBtn.addEventListener('click', toggleDesktopSidebar);
            }

            // é®ç½©å±‚ç‚¹å‡»å…³é—­
            document.addEventListener('click', function(e) {
                if (e.target.id === 'mobile-overlay') {
                    hideMobileInfoPanel();
                }
            });

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 27) {
                    hideMobileInfoPanel();
                    hideDesktopSidebar();
                }
            });
        });
    </script>
</body>
</html>