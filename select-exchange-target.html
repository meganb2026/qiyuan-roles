<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‡ç¼˜48 - é€‰æ‹©äº¤æ¢å¯¹è±¡</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯æŒ‰é’® -->
    <div id="mobile-info-btn" style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1000; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ“¦</div>

    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿ -->
    <div id="mobile-info-panel" style="display: none; position: fixed; bottom: 80px; right: 20px; width: 250px; max-height: 300px; background: rgba(255, 255, 255, 0.98); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); z-index: 1000; padding: 15px; overflow-y: auto;">
        <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
    </div>

    <!-- é®ç½©å±‚ -->
    <div id="mobile-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>

    <!-- é€‰æ‹©äº¤æ¢å¯¹è±¡å†…å®¹åŒºåŸŸ -->
    <div id="exchange-target-content">
        <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="assets/js/characters.js"></script>
    <script src="assets/js/items.js"></script>
    <script>
        // ä»URLå‚æ•°è·å–è§’è‰²ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const currentCharacter = urlParams.get('character') || 'claudius';
        const day = urlParams.get('day') || '1';

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            selectedCharacter: currentCharacter,
            currentDay: parseInt(day),
            gameStarted: true,
            playerInventory: [],
            allCharactersItems: {},
            npcs: []
        };

        // åˆå§‹åŒ–è§’è‰²æ•°æ®
        function initCharacterData() {
            const char = window.characters[currentCharacter];
            gameState.playerInventory = [...char.initialItems];
            updateMobileInfoPanel();
            showExchangeTargetSelection();
        }

        // æ˜¾ç¤ºé€‰æ‹©äº¤æ¢å¯¹è±¡é¡µé¢
        function showExchangeTargetSelection() {
            const currentChar = window.characters[currentCharacter];
            const availableTargets = Object.keys(window.characters).filter(id => id !== currentCharacter);

            const targetCards = availableTargets.map(targetId => {
                const targetChar = window.characters[targetId];
                return `
                    <div class="exchange-target-card" onclick="selectExchangeTarget('${targetId}')">
                        <div class="target-avatar">${targetChar.name.charAt(0)}</div>
                        <div class="target-info">
                            <h4>${targetChar.name}</h4>
                            <p class="target-title">${targetChar.title}</p>
                        </div>
                        <div class="visit-arrow">ğŸ </div>
                    </div>
                `;
            }).join('');

            const html = `
                <div class="page-container">
                    <h2>è¯·é€‰æ‹©ä½ è¦æ‹œè®¿è°</h2>

                    <div class="current-character-info">
                        <div class="character-summary">
                            <div class="character-avatar-small">${currentChar.name.charAt(0)}</div>
                            <div class="character-summary-text">
                                <strong>å½“å‰è§’è‰²ï¼š</strong>${currentChar.name} - ${currentChar.title}
                            </div>
                        </div>
                    </div>

                    <div class="exchange-targets-list">
                        ${targetCards}
                    </div>

                    <div class="exchange-instructions">
                        <div class="instruction-box">
                            <h4>ğŸ’¡ æç¤º</h4>
                            <ul>
                                <li>é€‰æ‹©ä¸€ä¸ªè§’è‰²å‰å»æ‹œè®¿</li>
                                <li>é€šè¿‡æ‹œè®¿æ”¶é›†çº¿ç´¢å’Œä¿¡æ¯</li>
                                <li>åˆç†åˆ†é…æ—¶é—´ï¼Œæ‹œè®¿å¤šäºº</li>
                                <li>è®°ä½ï¼šæ¯ä¸ªäººéƒ½æœ‰ç‹¬ç‰¹çš„çº¿ç´¢</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('exchange-target-content').innerHTML = html;
        }

        // é€‰æ‹©äº¤æ¢å¯¹è±¡
        function selectExchangeTarget(targetId) {
            // è·³è½¬åˆ°å¯¹åº”çš„å¯¹è¯åœºæ™¯
            const dialogUrl = `dialogue-${currentCharacter}-${targetId}.html?character=${currentCharacter}&target=${targetId}&day=${day}`;
            window.location.href = dialogUrl;
        }

        // æ›´æ–°ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function updateMobileInfoPanel() {
            const isMobile = window.innerWidth <= 768;

            // æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.style.display = (isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            if (!isMobile || !gameState.gameStarted) {
                hideMobileInfoPanel();
                return;
            }

            const char = window.characters[gameState.selectedCharacter];
            const panel = document.getElementById('mobile-info-panel');

            if (panel) {
                panel.innerHTML = `
                    <div class="character-info">
                        <strong>è§’è‰²ï¼š</strong>
                        <span>${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4>ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="mobile-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${item}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} å¤©</strong>
                    </div>
                `;
            }
        }

        // åˆ‡æ¢ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function toggleMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            if (panel) {
                const isVisible = panel.style.display === 'block';
                if (isVisible) {
                    hideMobileInfoPanel();
                } else {
                    showMobileInfoPanel();
                }
            }
        }

        // æ˜¾ç¤ºç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function showMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            const overlay = document.getElementById('mobile-overlay');

            if (panel && overlay) {
                panel.style.display = 'block';
                overlay.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        // éšè—ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function hideMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            const overlay = document.getElementById('mobile-overlay');

            if (panel && overlay) {
                panel.style.display = 'none';
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // äº‹ä»¶ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            initCharacterData();

            // ç§»åŠ¨ç«¯æŒ‰é’®äº‹ä»¶
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.addEventListener('click', toggleMobileInfoPanel);
            }

            // é®ç½©å±‚ç‚¹å‡»å…³é—­
            document.addEventListener('click', function(e) {
                if (e.target.id === 'mobile-overlay') {
                    hideMobileInfoPanel();
                }
            });

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 27) {
                    hideMobileInfoPanel();
                }
            });
        });
    </script>
</body>
</html>