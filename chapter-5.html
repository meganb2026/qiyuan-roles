<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬5ç« ï¼šæ¢¦é­‡çš„åœ°å›¾</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯æŒ‰é’® -->
    <div id="mobile-info-btn" style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1000; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ“¦</div>

    <!-- ç§»åŠ¨ç«¯åœ°å›¾æŒ‰é’® -->
    <div id="mobile-map-btn" style="position: fixed; bottom: 90px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1000; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ—ºï¸</div>

    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿ -->
    <div id="mobile-info-panel" style="display: none; position: fixed; bottom: 80px; right: 20px; width: 250px; max-height: 300px; background: rgba(255, 255, 255, 0.98); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); z-index: 1000; padding: 15px; overflow-y: auto;">
        <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
    </div>

    <!-- ç”µè„‘ç«¯ä¾§è¾¹æ  -->
    <div id="desktop-sidebar" style="display: none; position: fixed; top: 80px; right: 20px; width: 280px; max-height: 80vh; background: rgba(255, 255, 255, 0.95); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); z-index: 1000; padding: 20px; overflow-y: auto; border: 1px solid #e0e0e0;">
        <h4 style="margin: 0 0 15px 0; color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 8px;">è§’è‰²ä¿¡æ¯</h4>
        <div id="desktop-sidebar-content">
            <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
        </div>
    </div>

    <!-- é®ç½©å±‚ -->
    <div id="mobile-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>

    <!-- åœ°å›¾é¢æ¿ -->
    <div id="map-panel" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80vw; max-width: 800px; height: 80vh; max-height: 600px; background: rgba(255, 255, 255, 0.95); border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); z-index: 1001; padding: 20px; overflow: hidden;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: #667eea;">ç«‹æ–¹ä½“åœ°å›¾</h3>
            <button onclick="toggleMapPanel()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
        </div>
        <div id="cube-map" style="width: 100%; height: 80%; display: flex; align-items: center; justify-content: center; perspective: 1000px;">
            <!-- ç«‹æ–¹ä½“åœ°å›¾å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
        </div>
        <div style="margin-top: 20px; text-align: center; font-size: 14px; color: #666;">
            <p>ç‚¹å‡»æ‹–åŠ¨å¯ä»¥æ—‹è½¬åœ°å›¾çœ‹åˆ°å…¨è²Œ</p>
        </div>
    </div>

    <!-- åœ°å›¾é®ç½©å±‚ -->
    <div id="map-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 1000;"></div>

    <!-- ç”µè„‘ç«¯ä¿¡æ¯æŒ‰é’® -->
    <div id="desktop-info-btn" style="position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1001; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ“¦</div>

    <!-- ç”µè„‘ç«¯åœ°å›¾æŒ‰é’® -->
    <div id="desktop-map-btn" style="position: fixed; top: 90px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1001; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ—ºï¸</div>

    <!-- ç¬¬5ç« å†…å®¹ -->
    <div id="chapter-5-content">
        <div class="page-container">
            <h2>ç¬¬5ç« ï¼šæ¢¦é­‡çš„åœ°å›¾</h2>

            <div class="dialogue-container">
                <div class="dialogue-scene">
                    <p>ä½ å¿½ç„¶æ„Ÿåˆ°èƒŒåŒ…ä¸€æ²‰ï¼Œä»æ¢¦ä¸­é†’æ¥ã€‚æ‰“å¼€èƒŒåŒ…ï¼Œå‘ç°é‡Œé¢å¤šäº†ä¸€æ ·ä¸œè¥¿ã€‚</p>
                </div>

                <div class="dialogue-section">
                    <div class="character-portrait visitor">
                        <div class="portrait-circle">ğŸ‘¤</div>
                        <div class="character-name" id="player-name-5">ä½ </div>
                    </div>
                    <div class="dialogue-bubble visitor-bubble">
                        <p>è¿™æ˜¯ä»€ä¹ˆï¼Ÿ</p>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="dialogue-bubble host-bubble">
                        <p>è¿™æ˜¯æ¢¦é­‡çš„åœ°å›¾ï¼Œå®ƒä¼šæŒ‡å¼•ä½ æ‰¾åˆ°çœŸç›¸ã€‚</p>
                    </div>
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ˜ˆ</div>
                        <div class="character-name">æ¢¦é­‡</div>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="character-portrait visitor">
                        <div class="portrait-circle">ğŸ‘¤</div>
                        <div class="character-name" id="player-name-5">ä½ </div>
                    </div>
                    <div class="dialogue-bubble visitor-bubble">
                        <p>é‚£å®ƒæ€ä¹ˆçœ‹èµ·æ¥åƒä¸€ä¸ªæ­£ç«‹æ–¹ä½“ï¼Ÿ</p>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="dialogue-bubble host-bubble">
                        <p>æ˜¯çš„ã€‚ä½ çœ‹è¿™ä¸ªç«‹æ–¹ä½“æœ‰8ä¸ªé¡¶ç‚¹ï¼Œæ¯ä¸ªé¡¶ç‚¹ä»£è¡¨ç€ä¸€ä¸ªåœ°ç‚¹ã€‚è¿™8ä¸ªåœ°ç‚¹åˆæœ‰12æ¡è¾¹ç›¸è¿ï¼Œæ¯æ¡è¾¹ä»£è¡¨ç€ç›¸è¿çš„åœ°ç‚¹æ˜¯ç›¸é‚»çš„ã€‚</p>
                    </div>
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ˜ˆ</div>
                        <div class="character-name">æ¢¦é­‡</div>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="character-portrait visitor">
                        <div class="portrait-circle">ğŸ‘¤</div>
                        <div class="character-name" id="player-name-5">ä½ </div>
                    </div>
                    <div class="dialogue-bubble visitor-bubble">
                        <p>é‚£æˆ‘è¦æ€ä¹ˆçœ‹åˆ°è¿™äº›åœ°ç‚¹çš„å¯¹åº”å…³ç³»ï¼Ÿ</p>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="dialogue-bubble host-bubble">
                        <p>çœ‹åˆ°å±å¹•ä¸Šçš„ğŸ—ºï¸å›¾æ ‡äº†å—ï¼Ÿç‚¹å‡»å®ƒå°±èƒ½çœ‹åˆ°ã€‚å¦‚æœä½ çœ‹åˆ°çš„æ ‡è¯†è¢«é®æŒ¡äº†ï¼Œå¯ä»¥æ‹–åŠ¨ç«‹æ–¹ä½“è®©å®ƒæ—‹è½¬ã€‚</p>
                    </div>
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ˜ˆ</div>
                        <div class="character-name">æ¢¦é­‡</div>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="character-portrait visitor">
                        <div class="portrait-circle">ğŸ‘¤</div>
                        <div class="character-name" id="player-name-5">ä½ </div>
                    </div>
                    <div class="dialogue-bubble visitor-bubble">
                        <p>é‚£æˆ‘è¦èµ°åˆ°å“ªé‡Œå»ï¼Ÿ</p>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="dialogue-bubble host-bubble">
                        <p>æ¡æ¡å¤§è·¯é€šç½—é©¬ã€‚ä½†æ˜¯è¯åˆè¯´å›æ¥äº†ï¼ŒæˆåŠŸçš„é“è·¯å¿…ç„¶æ˜¯æœ€è¿œçš„ã€‚</p>
                    </div>
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ˜ˆ</div>
                        <div class="character-name">æ¢¦é­‡</div>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="character-portrait visitor">
                        <div class="portrait-circle">ğŸ‘¤</div>
                        <div class="character-name" id="player-name-5">ä½ </div>
                    </div>
                    <div class="dialogue-bubble visitor-bubble">
                        <p>æˆ‘æ€ä¹ˆä¼¼æ‡‚éæ‡‚ï¼Ÿ</p>
                    </div>
                </div>

                <div class="dialogue-section">
                    <div class="dialogue-bubble host-bubble">
                        <p>çº¸ä¸Šè°ˆæ¥ç»ˆè§‰æµ…ï¼Œä½ è¯•è¿‡å°±çŸ¥é“äº†ã€‚</p>
                    </div>
                    <div class="character-portrait host">
                        <div class="portrait-circle">ğŸ˜ˆ</div>
                        <div class="character-name">æ¢¦é­‡</div>
                    </div>
                </div>

                <div class="dialogue-actions">
                    <button class="action-btn primary large" onclick="goToFinalResult()">
                        ç»§ç»­
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="assets/js/characters.js"></script>
    <script src="assets/js/items.js"></script>
    <script src="assets/js/itemStories.js"></script>
    <script src="assets/js/backpack-improvements.js"></script>
    <script src="assets/js/item-details.js"></script>
    <script src="assets/js/map.js"></script>
    <script>
        // ä»URLå‚æ•°è·å–ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const currentCharacter = urlParams.get('character') || 'claudius';
        const day = urlParams.get('day') || '4';

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            selectedCharacter: currentCharacter,
            currentDay: parseInt(day),
            gameStarted: true,
            playerInventory: [],
            allCharactersItems: {},
            npcs: []
        };

        // ä»localStorageåŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const savedState = localStorage.getItem('qiyuanGameState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                gameState = { ...gameState, ...parsedState };
            } else {
                // åˆå§‹åŒ–é»˜è®¤ç‰©å“
                initDefaultItems();
            }
        }

        // åˆå§‹åŒ–é»˜è®¤ç‰©å“
        function initDefaultItems() {
            const char = window.characters[currentCharacter];
            gameState.playerInventory = [...char.initialItems];
            gameState.allCharactersItems = {};

            // ä¸ºæ‰€æœ‰è§’è‰²åˆå§‹åŒ–ç‰©å“
            Object.keys(window.characters).forEach(charId => {
                gameState.allCharactersItems[charId] = [...window.characters[charId].initialItems];
            });
        }

        // æ›´æ–°å¯¹è¯ä¸­çš„è§’è‰²åç§°å’Œå¤´åƒ
        function updatePlayerNameInDialogue() {
            const char = window.characters[gameState.selectedCharacter];
            if (char) {
                // æ›´æ–°æ‰€æœ‰å¯¹è¯éƒ¨åˆ†ä¸­çš„è§’è‰²åç§°
                const playerNameElements = document.querySelectorAll('.character-portrait.visitor .character-name');
                playerNameElements.forEach(element => {
                    element.textContent = char.name;
                });
                
                // æ›´æ–°æ‰€æœ‰å¯¹è¯éƒ¨åˆ†ä¸­çš„è§’è‰²å¤´åƒ
                const portraitElements = document.querySelectorAll('.character-portrait.visitor .portrait-circle');
                portraitElements.forEach(element => {
                    if (char.icon) {
                        element.textContent = char.icon;
                    }
                });
            }
        }

        // ç»§ç»­åˆ°é€‰æ‹©ç›®çš„åœ°é¡µé¢
        function goToFinalResult() {
            // è§’è‰²ä¸åœ°ç‚¹çš„æ˜ å°„å…³ç³»
            const characterLocationMap = {
                'claudius': 'claudius-bedroom',
                'chengying': 'chengying-pharmacy',
                'hefei': 'hefei-bedroom',
                'lixiang': 'lixiang-study',
                'wuzhizhe': 'wuzhizhe-livingroom',
                'wangweiguo': 'wangweiguo-dorm'
            };
            
            // å‡è®¾å½“å‰è§’è‰²æ­£åœ¨è‡ªå·±å®¶é‡Œï¼Œä½¿ç”¨è§’è‰²å¯¹åº”çš„åœ°ç‚¹ä½œä¸ºæ¥æº
            const fromLocation = characterLocationMap[currentCharacter] || 'claudius-bedroom';
            
            // è·³è½¬åˆ°é€‰æ‹©ç›®çš„åœ°é¡µé¢
            const navigationUrl = `locations/common-navigation.html?character=${currentCharacter}&day=${gameState.currentDay}&from=${fromLocation}`;
            window.location.href = navigationUrl;
        }

        // æ›´æ–°ä¿¡æ¯é¢æ¿ï¼ˆæ”¯æŒç§»åŠ¨ç«¯å’Œç”µè„‘ç«¯ï¼‰
        function updateInfoPanel() {
            const isMobile = window.innerWidth <= 768;

            // æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.style.display = (isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            // ç§»åŠ¨ç«¯åœ°å›¾æŒ‰é’®æ˜¾ç¤º
            const mobileMapBtn = document.getElementById('mobile-map-btn');
            if (mobileMapBtn) {
                mobileMapBtn.style.display = (isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            // ç”µè„‘ç«¯æŒ‰é’®æ˜¾ç¤º
            const desktopBtn = document.getElementById('desktop-info-btn');
            if (desktopBtn) {
                desktopBtn.style.display = (!isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            // ç”µè„‘ç«¯åœ°å›¾æŒ‰é’®æ˜¾ç¤º
            const desktopMapBtn = document.getElementById('desktop-map-btn');
            if (desktopMapBtn) {
                desktopMapBtn.style.display = (!isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            if (!gameState.gameStarted) {
                hideMobileInfoPanel();
                hideDesktopSidebar();
                return;
            }

            // æ›´æ–°ç”µè„‘ç«¯ä¾§è¾¹æ å†…å®¹ï¼Œä½†ä¸è‡ªåŠ¨æ˜¾ç¤º
            if (!isMobile) {
                updateDesktopSidebarContent();
                return;
            }

            // ç§»åŠ¨ç«¯æ˜¾ç¤ºé¢æ¿
            const char = window.characters[gameState.selectedCharacter];
            const panel = document.getElementById('mobile-info-panel');

            if (panel) {
                panel.innerHTML = `
                    <div class="character-info">
                        <strong>è§’è‰²ï¼š</strong>
                        <span>${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4>ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="mobile-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${getItemDisplayName(item)}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} ç« </strong>
                    </div>
                `;
            }
        }

        // æ›´æ–°ç”µè„‘ç«¯ä¾§è¾¹æ å†…å®¹
        function updateDesktopSidebarContent() {
            const sidebar = document.getElementById('desktop-sidebar');
            const content = document.getElementById('desktop-sidebar-content');

            if (sidebar && content) {
                const char = window.characters[gameState.selectedCharacter];
                content.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>å½“å‰è§’è‰²ï¼š</strong><br>
                        <span style="color: #667eea; font-size: 16px;">${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4 style="margin: 15px 0 10px 0; color: #667eea; font-size: 14px;">ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="desktop-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic; padding: 10px;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f8f9ff; border-radius: 5px; border-left: 3px solid #667eea;">${getItemDisplayName(item)}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} ç« </strong>
                    </div>
                `;
            }
        }

        // éšè—ç”µè„‘ç«¯ä¾§è¾¹æ 
        function hideDesktopSidebar() {
            const sidebar = document.getElementById('desktop-sidebar');
            if (sidebar) {
                sidebar.style.display = 'none';
            }
        }

        // åˆ‡æ¢ç”µè„‘ç«¯ä¾§è¾¹æ 
        function toggleDesktopSidebar() {
            const sidebar = document.getElementById('desktop-sidebar');
            if (sidebar) {
                const isVisible = sidebar.style.display === 'block';
                if (isVisible) {
                    sidebar.style.display = 'none';
                } else {
                    sidebar.style.display = 'block';
                }
            }
        }

        // æ˜¾ç¤ºç”µè„‘ç«¯ä¾§è¾¹æ 
        function showDesktopSidebar() {
            const sidebar = document.getElementById('desktop-sidebar');
            const content = document.getElementById('desktop-sidebar-content');

            if (sidebar && content) {
                const char = window.characters[gameState.selectedCharacter];
                content.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>å½“å‰è§’è‰²ï¼š</strong><br>
                        <span style="color: #667eea; font-size: 16px;">${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4 style="margin: 15px 0 10px 0; color: #667eea; font-size: 14px;">ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="desktop-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic; padding: 10px;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f8f9ff; border-radius: 5px; border-left: 3px solid #667eea;">${getItemDisplayName(item)}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} ç« </strong>
                    </div>
                `;
                sidebar.style.display = 'block';
            }
        }

        // éšè—ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function hideMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            const overlay = document.getElementById('mobile-overlay');

            if (panel && overlay) {
                panel.style.display = 'none';
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // ç»§ç»­åˆ°é€‰æ‹©ç›®çš„åœ°é¡µé¢
        function goToFinalResult() {
            // è§’è‰²ä¸åœ°ç‚¹çš„æ˜ å°„å…³ç³»
            const characterLocationMap = {
                'claudius': 'claudius-bedroom',
                'chengying': 'chengying-pharmacy',
                'hefei': 'hefei-bedroom',
                'lixiang': 'lixiang-study',
                'wuzhizhe': 'wuzhizhe-livingroom',
                'wangweiguo': 'wangweiguo-dorm'
            };
            
            // å‡è®¾å½“å‰è§’è‰²æ­£åœ¨è‡ªå·±å®¶é‡Œï¼Œä½¿ç”¨è§’è‰²å¯¹åº”çš„åœ°ç‚¹ä½œä¸ºæ¥æº
            const fromLocation = characterLocationMap[currentCharacter] || 'claudius-bedroom';
            
            // è·³è½¬åˆ°é€‰æ‹©ç›®çš„åœ°é¡µé¢
            const navigationUrl = `locations/common-navigation.html?character=${currentCharacter}&day=${gameState.currentDay}&from=${fromLocation}`;
            window.location.href = navigationUrl;
        }

        // åˆ‡æ¢ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function toggleMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            if (panel) {
                const isVisible = panel.style.display === 'block';
                if (isVisible) {
                    hideMobileInfoPanel();
                } else {
                    const char = window.characters[gameState.selectedCharacter];
                    panel.innerHTML = `
                        <div class="character-info">
                            <strong>è§’è‰²ï¼š</strong>
                            <span>${char.name}</span><br>
                            <small style="color: #666;">${char.title}</small>
                        </div>

                        <h4>ğŸ“¦ èƒŒåŒ…</h4>
                        <div id="mobile-inventory">
                            ${gameState.playerInventory.length === 0 ?
                                '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                                gameState.playerInventory.map(item =>
                                    `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${getItemDisplayName(item)}</div>`
                                ).join('')
                            }
                        </div>

                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                            <strong>ç¬¬ ${gameState.currentDay} ç« </strong>
                        </div>
                    `;
                    panel.style.display = 'block';
                    document.getElementById('mobile-overlay').style.display = 'block';
                    document.body.style.overflow = 'hidden';
                }
            }
        }

        // åœ°å›¾åŠŸèƒ½å·²ç§»è‡³å¤–éƒ¨æ–‡ä»¶ map.js

        // äº‹ä»¶ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            updateInfoPanel();
            updatePlayerNameInDialogue();

            // ç§»åŠ¨ç«¯æŒ‰é’®äº‹ä»¶
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.addEventListener('click', toggleMobileInfoPanel);
            }

            // ç§»åŠ¨ç«¯åœ°å›¾æŒ‰é’®äº‹ä»¶
            const mobileMapBtn = document.getElementById('mobile-map-btn');
            if (mobileMapBtn) {
                mobileMapBtn.addEventListener('click', toggleMapPanel);
            }

            // ç”µè„‘ç«¯æŒ‰é’®äº‹ä»¶
            const desktopBtn = document.getElementById('desktop-info-btn');
            if (desktopBtn) {
                desktopBtn.addEventListener('click', toggleDesktopSidebar);
            }

            // ç”µè„‘ç«¯åœ°å›¾æŒ‰é’®äº‹ä»¶
            const desktopMapBtn = document.getElementById('desktop-map-btn');
            if (desktopMapBtn) {
                desktopMapBtn.addEventListener('click', toggleMapPanel);
            }

            // é®ç½©å±‚ç‚¹å‡»å…³é—­
            document.addEventListener('click', function(e) {
                if (e.target.id === 'mobile-overlay') {
                    hideMobileInfoPanel();
                }
                if (e.target.id === 'map-overlay') {
                    toggleMapPanel();
                }
            });

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 27) {
                    hideMobileInfoPanel();
                    hideDesktopSidebar();
                    toggleMapPanel();
                }
            });
        });
    </script>
</body>
</html>