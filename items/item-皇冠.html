<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©å“è¯¦æƒ…</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯æŒ‰é’® -->
    <div id="mobile-info-btn" style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1000; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ“¦</div>

    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿ -->
    <div id="mobile-info-panel" style="display: none; position: fixed; bottom: 80px; right: 20px; width: 250px; max-height: 300px; background: rgba(255, 255, 255, 0.98); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); z-index: 1000; padding: 15px; overflow-y: auto;">
        <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
    </div>

    <!-- ç”µè„‘ç«¯ä¾§è¾¹æ  -->
    <div id="desktop-sidebar" style="display: none; position: fixed; top: 20px; right: 20px; width: 280px; max-height: 80vh; background: rgba(255, 255, 255, 0.95); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); z-index: 1000; padding: 20px; overflow-y: auto; border: 1px solid #e0e0e0;">
        <h4 style="margin: 0 0 15px 0; color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 8px;">è§’è‰²ä¿¡æ¯</h4>
        <div id="desktop-sidebar-content">
            <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
        </div>
    </div>

    <!-- é®ç½©å±‚ -->
    <div id="mobile-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>

    <!-- ç‰©å“è¯¦æƒ…å†…å®¹åŒºåŸŸ -->
    <div id="item-content">
        <div class="page-container">
            <h2>ç‰©å“è¯¦æƒ…</h2>

            <div class="item-detail-container">
                <div class="item-header">
                    <div class="item-icon">ğŸ“¦</div>
                    <div class="item-info">
                        <h3 id="item-name">ç‰©å“åç§°</h3>
                        <p id="item-description">ç‰©å“æè¿°</p>
                    </div>
                </div>

                <div class="item-story">
                    <h4>ğŸ“– ç‰©å“èƒŒåçš„æ•…äº‹</h4>
                    <div id="item-story-content">
                        ç‰©å“æ•…äº‹å†…å®¹
                    </div>
                </div>

                <div class="item-actions">
                    <button class="action-btn primary large" onclick="continueInvestigation()">
                        ç»§ç»­è°ƒæŸ¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="../assets/js/characters.js"></script>
    <script src="../assets/js/items.js"></script>
    <script>
        // ä»URLå‚æ•°è·å–ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const currentCharacter = urlParams.get('character') || 'claudius';
        const day = urlParams.get('day') || '1';
        const from = urlParams.get('from') || 'exchange';

        // ä»URLè·¯å¾„è·å–ç‰©å“åç§°
        const pathParts = window.location.pathname.split('/');
        const filename = pathParts[pathParts.length - 1];
        const itemName = decodeURIComponent(filename.replace('item-', '').replace('.html', ''));

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            selectedCharacter: currentCharacter,
            currentDay: parseInt(day),
            gameStarted: true,
            playerInventory: [],
            allCharactersItems: {},
            npcs: []
        };

        // ç‰©å“æ•…äº‹æ•°æ®
        const itemStories = {
            "çš‡å† ": {
                name: "çš‡å† ",
                description: "è±¡å¾ç‹æƒçš„ç‰©å“ï¼Œé€šå¸¸ç”±å›½ç‹ä½©æˆ´ã€‚",
                story: "è¿™é¡¶çš‡å† æ˜¯ä¸¹éº¦ç‹å®¤çš„ä¼ æ‰¿ä¹‹ç‰©ï¼Œä¸Šé¢é•¶åµŒç€æ— æ•°çè´µçš„å®çŸ³ã€‚æ¯ä¸€ä½å›½ç‹ç™»åŸºæ—¶éƒ½ä¼šä½©æˆ´å®ƒï¼Œä»¥æ˜¾ç¤ºè‡³é«˜æ— ä¸Šçš„æƒåŠ›ã€‚ç„¶è€Œï¼Œè¿™é¡¶çš‡å† èƒŒåéšè—ç€ä¸€ä¸ªä¸ä¸ºäººçŸ¥çš„ç§˜å¯†ï¼šå®ƒçš„å†…ä¾§åˆ»ç€å‰ä»»å›½ç‹çš„æ­»äº¡æ—¥æœŸã€‚å…‹åŠ³ç‹„æ–¯ç»§æ‰¿ç‹ä½åï¼Œè¿™ä¸ªç§˜å¯†æˆä¸ºäº†ä»–çš„å¿ƒç—…ã€‚ä»–å®³æ€•æœ‰äººå‘ç°çš‡å† ä¸Šçš„åˆ»ç—•ï¼Œé‚£å°†æ­éœ²ä»–ç¯¡ä½çš„çœŸç›¸ã€‚"
            },
            "çç é€šå…³ä¿¡ç‰©": {
                name: "çç é€šå…³ä¿¡ç‰©",
                description: "ä¸€æšé•¶åµŒçç çš„ä¿¡ç‰©ï¼Œç”¨äºåœ¨çš‡å®«å†…é€šè¡Œæ— é˜»ã€‚",
                story: "è¿™æšçç ä¿¡ç‰©æ˜¯çš‡å®«å®ˆå«çš„é€šè¡Œè¯ï¼Œåªæœ‰å°‘æ•°äººæ‰èƒ½æŒæœ‰ã€‚ç›¸ä¼ è¿™æšä¿¡ç‰©æ˜¯ç”±ç¬¬ä¸€ä»£ä¸¹éº¦å›½ç‹äº²æ‰‹åˆ¶ä½œï¼Œè±¡å¾ç€ç»å¯¹çš„å¿ è¯šå’ŒæƒåŠ›ã€‚å®ƒèƒ½æ‰“å¼€çš‡å®«ä¸­å¤§éƒ¨åˆ†çš„ç¦é—­åŒºåŸŸï¼ŒåŒ…æ‹¬é‚£äº›éšè—ç€å¤è€ç§˜å¯†çš„åœ°ä¸‹å®¤ã€‚ç„¶è€Œï¼ŒæŒæœ‰è¿™æšä¿¡ç‰©çš„äººå¿…é¡»æ—¶åˆ»å°å¿ƒï¼Œå› ä¸ºå®ƒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªè¿½è¸ªå™¨ï¼Œè®°å½•ç€æŒæœ‰è€…çš„æ¯ä¸€æ¬¡è¡ŒåŠ¨ã€‚"
            },
            "é‡‘é’±": {
                name: "é‡‘é’±",
                description: "ä¸€è¢‹é‡‘å¸ï¼Œç”¨äºè´¿èµ‚æˆ–è´­ä¹°ç‰©å“ã€‚",
                story: "è¿™è¢‹é‡‘å¸è¡¨é¢çœ‹èµ·æ¥æ™®é€šï¼Œä½†æ¯ä¸€æšéƒ½é“¸æœ‰ç‰¹æ®Šçš„æ ‡è®°ã€‚è¿™äº›é‡‘å¸æ¥è‡ªäºå…‹åŠ³ç‹„æ–¯ç™»åŸºåé“¸é€ çš„æ–°å¸ï¼Œä¸Šé¢å°ç€ä»–çš„å¤´åƒã€‚é‡‘å¸çš„æµé€šè®©å…‹åŠ³ç‹„æ–¯èƒ½å¤ŸæŒæ¡çš‡å®«å†…å¤–çš„ç»æµå‘½è„‰ï¼Œä»–å¯ä»¥é€šè¿‡é‡‘å¸çš„æµå‘è¿½è¸ªæ½œåœ¨çš„å›å¾’ã€‚åŒæ—¶ï¼Œè¿™äº›é‡‘å¸ä¹Ÿæˆä¸ºäº†æƒåŠ›çš„è±¡å¾ï¼ŒæŒæœ‰å®ƒä»¬çš„äººå¾€å¾€èƒ½ä¹°é€šäººå¿ƒï¼Œè·å¾—é‡è¦çš„æƒ…æŠ¥ã€‚"
            },
            "ä¸­è‰è¯": {
                name: "ä¸­è‰è¯",
                description: "å„ç§çè´µçš„ä¸­è‰è¯æï¼Œç”±å¾¡åŒ»äº²è‡ªé‡‡é›†ã€‚",
                story: "è¿™äº›ä¸­è‰è¯éƒ½æ˜¯ç¨‹å©´å¤šå¹´æ¥ç²¾å¿ƒé‡‡é›†çš„çè´µè¯æï¼Œå…¶ä¸­ä¸ä¹ä¸€äº›å¤±ä¼ å·²ä¹…çš„ç§˜æ–¹ã€‚ç¨‹å©´ä¸€ç›´æ€€ç–‘å‰ä»»å›½ç‹çš„æ­»å› ä¸ä¸­æ¯’æœ‰å…³ï¼Œä»–é€šè¿‡ç ”ç©¶è¿™äº›è¯æï¼Œå¸Œæœ›èƒ½æ‰¾å‡ºè§£è¯æˆ–è€…æ¯’è¯çš„æˆåˆ†ã€‚è¿™äº›è¯æä¸ä»…èƒ½æ•‘äººæ€§å‘½ï¼Œä¹Ÿèƒ½æ‚„æ— å£°æ¯åœ°å¤ºèµ°ç”Ÿå‘½ã€‚ç¨‹å©´çŸ¥é“ï¼Œçš‡å®«ä¸­çš„æ¯ä¸€ä¸ªäººéƒ½å¯èƒ½æˆä¸ºä»–çš„å®éªŒå¯¹è±¡ã€‚"
            },
            "å®‰çœ è¯": {
                name: "å®‰çœ è¯",
                description: "èƒ½è®©äººæ·±åº¦ç¡çœ çš„è¯ç‰©ã€‚",
                story: "è¿™ç§å®‰çœ è¯æ˜¯ç¨‹å©´çš„ç‹¬é—¨ç§˜æ–¹ï¼Œèƒ½å¤Ÿè®©äººé™·å…¥æ·±åº¦ç¡çœ ï¼Œå¿˜è®°ä¸€åˆ‡çƒ¦æ¼ã€‚ç„¶è€Œï¼Œè¿™ç§è¯ç‰©çš„å‰¯ä½œç”¨æ˜¯ä¼šè®©äººäº§ç”Ÿå¹»è§‰ï¼Œçœ‹åˆ°å†…å¿ƒæ·±å¤„çš„ææƒ§ã€‚ç¨‹å©´æ›¾ç»ç”¨è¿™ç§è¯ç‰©æ²»ç–—è¿‡å…‹åŠ³ç‹„æ–¯çš„å¤±çœ ï¼Œä½†å…‹åŠ³ç‹„æ–¯ä»æ­¤å˜å¾—æ›´åŠ å¤šç–‘ã€‚ç¨‹å©´æ€€ç–‘ï¼Œè¿™ç§è¯ç‰©å¯èƒ½è¢«ç”¨æ¥æ©ç›–æŸäº›ä¸å¯å‘Šäººçš„ç§˜å¯†ã€‚"
            },
            "æ½œæ°´è£…å¤‡": {
                name: "æ½œæ°´è£…å¤‡",
                description: "ä¸“ä¸šçš„æ½œæ°´å·¥å…·ï¼ŒåŒ…æ‹¬æ°§æ°”ç“¶ã€æ½œæ°´æœç­‰ã€‚",
                story: "è¿™å¥—æ½œæ°´è£…å¤‡æ˜¯ä½•éçš„èŒä¸šå·¥å…·ï¼Œä»–æ›¾ç»æ˜¯ä¸€åä¸“ä¸šçš„æ½œæ°´æ•™ç»ƒã€‚è¿™äº›è£…å¤‡ä¸ä»…èƒ½è®©ä»–åœ¨æ°´ä¸‹è‡ªç”±æ´»åŠ¨ï¼Œè¿˜èƒ½è®©ä»–æ½œå…¥çš‡å®«çš„ä¸‹æ°´é“ç³»ç»Ÿï¼Œå¯»æ‰¾éšè—çš„å®è—ã€‚ä½•éçŸ¥é“çš‡å®«çš„åœ°ä¸‹æ°´é“é”™ç»¼å¤æ‚ï¼Œéšè—ç€è®¸å¤šä¸ä¸ºäººçŸ¥çš„ç§˜å¯†ã€‚ä»–åˆ©ç”¨è¿™äº›è£…å¤‡ï¼Œå¤šæ¬¡æ½œå…¥ç¦åŒºï¼Œå¯»æ‰¾èƒ½è®©ä»–ä¸€å¤œæš´å¯Œçš„æœºä¼šã€‚"
            },
            "éª°å­": {
                name: "éª°å­",
                description: "ä¸€å‰¯æ™®é€šçš„èµŒåšéª°å­ã€‚",
                story: "è¿™å‰¯éª°å­è¡¨é¢çœ‹èµ·æ¥æ™®é€šï¼Œä½†å®é™…ä¸Šè¢«ä½•éåšè¿‡æ‰‹è„šï¼Œèƒ½æ§åˆ¶ç‚¹æ•°ã€‚ä½•éé èµŒåšä¸ºç”Ÿï¼Œä½†ä»–çš„èµŒè¿ä¸€ç›´ä¸å¥½ï¼Œç›´åˆ°ä»–å­¦ä¼šäº†å‡ºåƒçš„æŠ€å·§ã€‚è¿™äº›éª°å­è®©ä»–åœ¨èµŒåœºä¸­å¦‚é±¼å¾—æ°´ï¼Œä¹Ÿè®©ä»–æ¬ ä¸‹äº†å·¨é¢èµŒå€ºã€‚ä½•éçŸ¥é“ï¼Œå¦‚æœä»–ä¸èƒ½åœ¨ä¸‰å¤©å†…è¿˜æ¸…å€ºåŠ¡ï¼Œä»–çš„ä¸‹åœºä¼šå¾ˆæƒ¨ã€‚"
            },
            "ç”»å…·": {
                name: "ç”»å…·",
                description: "ä¸€å¥—å®Œæ•´çš„ç»˜ç”»å·¥å…·ï¼ŒåŒ…æ‹¬ç”»ç¬”ã€é¢œæ–™ç­‰ã€‚",
                story: "è¿™äº›ç”»å…·æ˜¯ä½•éçš„å¦ä¸€ä¸ªèº«ä»½â€”â€”è‰ºæœ¯å®¶çš„è±¡å¾ã€‚ä»–æ›¾ç»æ¢¦æƒ³æˆä¸ºä¸€åç”»å®¶ï¼Œä½†ç°å®è®©ä»–æˆä¸ºäº†èµŒå¾’ã€‚è¿™äº›ç”»å…·ä¸ä»…èƒ½åˆ›ä½œç¾ä¸½çš„ç”»ä½œï¼Œè¿˜èƒ½ä¼ªé€ æ–‡ä»¶å’Œä¿¡ä»¶ã€‚ä½•éæ›¾ç»ç”¨è¿™äº›ç”»å…·ä¼ªé€ è¿‡å…‹åŠ³ç‹„æ–¯çš„ç­¾åï¼Œå¸®ä»–å®Œæˆè¿‡ä¸€äº›ä¸å¯å‘Šäººçš„äº¤æ˜“ã€‚ç°åœ¨ï¼Œè¿™äº›ç”»å…·æˆä¸ºäº†ä½•éæœ€åçš„æ•‘å‘½ç¨»è‰ã€‚"
            },
            "åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾": {
                name: "åœ°ä¸‹ç³»ç»Ÿè®¾è®¡å›¾",
                description: "çš‡å®«åœ°ä¸‹æ°´é“å’Œæ’æ±¡ç³»ç»Ÿçš„å®Œæ•´è®¾è®¡å›¾çº¸ã€‚",
                story: "è¿™å¼ è®¾è®¡å›¾æ˜¯ææƒ³çš„å¿ƒè¡€ä¹‹ä½œï¼Œè¯¦ç»†æ ‡æ³¨äº†çš‡å®«åœ°ä¸‹ç³»ç»Ÿçš„æ¯ä¸€ä¸ªè§’è½ã€‚å›¾çº¸ä¸Šä¸ä»…æœ‰æ°´é“çš„èµ°å‘ï¼Œè¿˜æœ‰è®¸å¤šéšè—çš„å¯†å®¤å’Œæš—é“ã€‚ææƒ³çŸ¥é“ï¼Œè¿™äº›å¯†é“æ›¾ç»è¢«ç”¨æ¥è¿é€è¿ç¦ç‰©å“ï¼Œç°åœ¨å¯èƒ½éšè—ç€å‰ä»»å›½ç‹çš„ç§˜å¯†ã€‚ææƒ³å¿…é¡»è¯æ˜å°¸ä½“çš„å‘ç°ä¸ä»–çš„è®¾è®¡æ— å…³ï¼Œå¦åˆ™ä»–çš„èŒä¸šç”Ÿæ¶¯å°†å°±æ­¤ç»“æŸã€‚"
            },
            "çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾": {
                name: "çš‡å®«åœ°é¢éƒ¨åˆ†è®¾è®¡å›¾",
                description: "çš‡å®«åœ°é¢å»ºç­‘çš„è¯¦ç»†è®¾è®¡å›¾çº¸ã€‚",
                story: "è¿™å¼ è®¾è®¡å›¾æ˜¯å´æ™ºå“²å¯¼å¸ˆç•™ä¸‹çš„çè´µé—äº§ï¼Œè®°å½•äº†çš‡å®«çš„æ¯ä¸€ä¸ªè§’è½ã€‚å›¾çº¸ä¸Šæ ‡æ³¨äº†è®¸å¤šä¸ä¸ºäººçŸ¥çš„æœºå…³å’Œå¯†é“ï¼Œè¿™äº›éƒ½æ˜¯ä¸ºäº†ä¿æŠ¤çš‡å®¤çš„ç§˜å¯†è€Œè®¾è®¡çš„ã€‚å´æ™ºå“²çš„å¯¼å¸ˆåœ¨å»ä¸–å‰ï¼Œå°†è¿™äº›ç§˜å¯†æ‰˜ä»˜ç»™äº†ä»–ã€‚ç°åœ¨ï¼Œå´æ™ºå“²å¿…é¡»æ‰¾åˆ°å¯¼å¸ˆç•™ä¸‹çš„çœŸæ­£ç§˜å¯†ï¼Œæ‰èƒ½å®Œæˆä»–çš„ä½¿å‘½ã€‚"
            },
            "å¯¼å¸ˆæ‰‹è®°": {
                name: "å¯¼å¸ˆæ‰‹è®°",
                description: "å·²æ•…å»ºç­‘è®¾è®¡å¸ˆç•™ä¸‹çš„ç¬”è®°å’Œå¿ƒå¾—ã€‚",
                story: "è¿™æœ¬æ‰‹è®°è®°å½•äº†å´æ™ºå“²å¯¼å¸ˆä¸€ç”Ÿçš„å»ºç­‘å¿ƒå¾—ï¼Œå…¶ä¸­éšè—ç€è®¸å¤šä¸ä¸ºäººçŸ¥çš„ç§˜å¯†ã€‚å¯¼å¸ˆåœ¨ç¬”è®°ä¸­æš—ç¤ºï¼Œçš‡å®«çš„è®¾è®¡å¹¶éè¡¨é¢é‚£ä¹ˆç®€å•ï¼Œå…¶ä¸­éšè—ç€ä¸€ä¸ªå·¨å¤§çš„é˜´è°‹ã€‚å´æ™ºå“²çŸ¥é“ï¼Œè¿™äº›ç¬”è®°æ˜¯æ­å¼€çœŸç›¸çš„å…³é”®ï¼Œä½†ä»–å¿…é¡»å°å¿ƒï¼Œå› ä¸ºçŸ¥é“å¤ªå¤šç§˜å¯†çš„äººï¼Œå¾€å¾€ä¼šé­é‡ä¸æµ‹ã€‚"
            },
            "çš‡å®«åœ°å›¾": {
                name: "çš‡å®«åœ°å›¾",
                description: "çš‡å®«çš„å®Œæ•´å¹³é¢å›¾ï¼Œæ ‡æ³¨äº†æ‰€æœ‰é‡è¦ä½ç½®ã€‚",
                story: "è¿™å¼ åœ°å›¾æ˜¯ç‹å«å›½çš„å¿…å¤‡å·¥å…·ï¼Œä»–éœ€è¦ç”¨å®ƒæ¥è§„åˆ’æ–½å·¥è·¯çº¿å’Œç‰©èµ„è¿è¾“ã€‚åœ°å›¾ä¸Šä¸ä»…æ ‡æ³¨äº†å»ºç­‘çš„ä½ç½®ï¼Œè¿˜è®°å½•äº†è®¸å¤šä¸ä¸ºäººçŸ¥çš„æ·å¾„å’Œå¯†é“ã€‚ç‹å«å›½çŸ¥é“ï¼Œè¿™äº›å¯†é“æ›¾ç»è¢«ç”¨æ¥è¿é€è¿ç¦ç‰©å“ï¼Œç°åœ¨å¯èƒ½ä¸å°¸ä½“äº‹ä»¶æœ‰å…³ã€‚ä»–å¿…é¡»ç¡®ä¿å·¥ç¨‹æŒ‰æ—¶å®Œæˆï¼Œå¦åˆ™ä»–çš„å›¢é˜Ÿå°†é¢ä¸´å¤„ç½šã€‚"
            },
            "å‘¨æŠ¥": {
                name: "å‘¨æŠ¥",
                description: "æ–½å·¥é˜Ÿçš„æ¯å‘¨å·¥ä½œæŠ¥å‘Šã€‚",
                story: "è¿™ä»½å‘¨æŠ¥è®°å½•äº†æ–½å·¥é˜Ÿçš„æ¯ä¸€é¡¹å·¥ä½œè¿›åº¦å’Œå‘ç°ã€‚ç‹å«å›½åœ¨æŠ¥å‘Šä¸­å‘ç°äº†ä¸€äº›å¯ç–‘çš„ç—•è¿¹ï¼Œæš—ç¤ºæœ‰äººåœ¨æš—ä¸­ç ´åå·¥ç¨‹ã€‚æŠ¥å‘Šä¸­æåˆ°äº†åœ°ä¸‹æ°´é“çš„å¼‚å¸¸æƒ…å†µï¼Œè¿™å¯èƒ½ä¸å°¸ä½“äº‹ä»¶çš„çœŸç›¸æœ‰å…³ã€‚ç‹å«å›½çŸ¥é“ï¼Œå¦‚æœä»–ä¸èƒ½åŠæ—¶å‘ç°é—®é¢˜ï¼Œæ•´ä¸ªå·¥ç¨‹éƒ½å¯èƒ½æ³¡æ±¤ã€‚"
            }
        };

        // ä»localStorageåŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const savedState = localStorage.getItem('qiyuanGameState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                gameState = { ...gameState, ...parsedState };
            } else {
                // åˆå§‹åŒ–é»˜è®¤ç‰©å“
                initDefaultItems();
            }
        }

        // åˆå§‹åŒ–é»˜è®¤ç‰©å“
        function initDefaultItems() {
            const char = window.characters[currentCharacter];
            gameState.playerInventory = [...char.initialItems];
            gameState.allCharactersItems = {};

            // ä¸ºæ‰€æœ‰è§’è‰²åˆå§‹åŒ–ç‰©å“
            Object.keys(window.characters).forEach(charId => {
                gameState.allCharactersItems[charId] = [...window.characters[charId].initialItems];
            });
        }

        // æ˜¾ç¤ºç‰©å“è¯¦æƒ…
        function showItemDetail() {
        function continueInvestigation() {
            // è¿”å›ç¬¬äºŒå¤©æ•…äº‹é¡µé¢
            const gameUrl = `../day2-story.html?character=${currentCharacter}&day=2&from=item-detail`;
            window.location.href = gameUrl;
        }            const itemData = itemStories[itemName];
            if (itemData) {
                document.getElementById('item-name').textContent = itemData.name;
                document.getElementById('item-description').textContent = itemData.description;
                document.getElementById('item-story-content').innerHTML = itemData.story;

                // è®¾ç½®ç‰©å“å›¾æ ‡
                const iconElement = document.querySelector('.item-icon');
                // å¯ä»¥æ ¹æ®ç‰©å“ç±»å‹è®¾ç½®ä¸åŒçš„å›¾æ ‡
                iconElement.textContent = 'ğŸ“¦';
            } else {
                document.getElementById('item-name').textContent = itemName;
                document.getElementById('item-description').textContent = 'æœªçŸ¥ç‰©å“';
                document.getElementById('item-story-content').innerHTML = 'è¿™ä¸ªç‰©å“çš„æ•…äº‹è¿˜æœªè¢«æ­ç¤º...';
            }

            updateInfoPanel();
        }

        // ç»§ç»­è°ƒæŸ¥
        function continueInvestigation() {
            // è¿”å›ç¬¬äºŒå¤©æ•…äº‹é¡µé¢
            const gameUrl = `../day2-story.html?character=${currentCharacter}&day=2&from=item-detail`;
            window.location.href = gameUrl;
        }

        // æ›´æ–°ä¿¡æ¯é¢æ¿ï¼ˆæ”¯æŒç§»åŠ¨ç«¯å’Œç”µè„‘ç«¯ï¼‰
        function updateInfoPanel() {
            const isMobile = window.innerWidth <= 768;

            // æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.style.display = (isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            if (!gameState.gameStarted) {
                hideMobileInfoPanel();
                return;
            }

            // å¦‚æœæ˜¯ç”µè„‘ç«¯ï¼Œç›´æ¥æ˜¾ç¤ºä¾§è¾¹æ 
            if (!isMobile) {
                showDesktopSidebar();
                return;
            }

            // ç§»åŠ¨ç«¯æ˜¾ç¤ºé¢æ¿
            const char = window.characters[gameState.selectedCharacter];
            const panel = document.getElementById('mobile-info-panel');

            if (panel) {
                panel.innerHTML = `
                    <div class="character-info">
                        <strong>è§’è‰²ï¼š</strong>
                        <span>${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4>ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="mobile-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${item}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} å¤©</strong>
                    </div>
                `;
                panel.style.display = 'block';
            }
        }

        // æ˜¾ç¤ºç”µè„‘ç«¯ä¾§è¾¹æ 
        function showDesktopSidebar() {
            const sidebar = document.getElementById('desktop-sidebar');
            const content = document.getElementById('desktop-sidebar-content');

            if (sidebar && content) {
                const char = window.characters[gameState.selectedCharacter];
                content.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>å½“å‰è§’è‰²ï¼š</strong><br>
                        <span style="color: #667eea; font-size: 16px;">${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4 style="margin: 15px 0 10px 0; color: #667eea; font-size: 14px;">ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="desktop-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic; padding: 10px;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f8f9ff; border-radius: 5px; border-left: 3px solid #667eea;">${item}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} å¤©</strong>
                    </div>
                `;
                sidebar.style.display = 'block';
            }
        }

        // éšè—ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function hideMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            const overlay = document.getElementById('mobile-overlay');

            if (panel && overlay) {
                panel.style.display = 'none';
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // åˆ‡æ¢ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function toggleMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            if (panel) {
                const isVisible = panel.style.display === 'block';
                if (isVisible) {
                    hideMobileInfoPanel();
                } else {
                    const char = window.characters[gameState.selectedCharacter];
                    panel.innerHTML = `
                        <div class="character-info">
                            <strong>è§’è‰²ï¼š</strong>
                            <span>${char.name}</span><br>
                            <small style="color: #666;">${char.title}</small>
                        </div>

                        <h4>ğŸ“¦ èƒŒåŒ…</h4>
                        <div id="mobile-inventory">
                            ${gameState.playerInventory.length === 0 ?
                                '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                                gameState.playerInventory.map(item =>
                                    `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${item}</div>`
                                ).join('')
                            }
                        </div>

                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                            <strong>ç¬¬ ${gameState.currentDay} å¤©</strong>
                        </div>
                    `;
                    panel.style.display = 'block';
                    document.getElementById('mobile-overlay').style.display = 'block';
                    document.body.style.overflow = 'hidden';
                }
            }
        }

        // äº‹ä»¶ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            showItemDetail();

            // ç§»åŠ¨ç«¯æŒ‰é’®äº‹ä»¶
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.addEventListener('click', toggleMobileInfoPanel);
            }

            // é®ç½©å±‚ç‚¹å‡»å…³é—­
            document.addEventListener('click', function(e) {
                if (e.target.id === 'mobile-overlay') {
                    hideMobileInfoPanel();
                }
            });

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 27) {
                    hideMobileInfoPanel();
                }
            });
        });
    </script>
</body>
</html>