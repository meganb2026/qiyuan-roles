<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‡ç¼˜48 - ç¬¬äºŒå¤©å†…å¿ƒç‹¬ç™½</title>
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯æŒ‰é’® -->
    <div id="mobile-info-btn" style="position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: #667eea; color: white; border: none; font-size: 20px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 1000; cursor: pointer; display: flex; align-items: center; justify-content: center;">ğŸ“¦</div>

    <!-- ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿ -->
    <div id="mobile-info-panel" style="display: none; position: fixed; bottom: 80px; right: 20px; width: 250px; max-height: 300px; background: rgba(255, 255, 255, 0.98); border-radius: 10px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); z-index: 1000; padding: 15px; overflow-y: auto;">
        <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€å¡«å…… -->
    </div>

    <!-- é®ç½©å±‚ -->
    <div id="mobile-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 999;"></div>

    <!-- å†…å¿ƒç‹¬ç™½å†…å®¹åŒºåŸŸ -->
    <div id="inner-thoughts-content">
        <!-- å†…å®¹ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="assets/js/characters.js"></script>
    <script src="assets/js/items.js"></script>
    <script src="assets/js/itemStories.js"></script>
    <script>
        // ä»URLå‚æ•°è·å–è§’è‰²ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const selectedCharacter = urlParams.get('character') || 'claudius';

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            selectedCharacter: selectedCharacter,
            currentDay: 2,
            gameStarted: true,
            playerInventory: [],
            allCharactersItems: {},
            npcs: []
        };

        // ä»localStorageåŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const savedState = localStorage.getItem('qiyuanGameState');
            if (savedState) {
                const parsedState = JSON.parse(savedState);
                gameState = { ...gameState, ...parsedState };
            }
        }

        // ç¬¬äºŒå¤©å†…å¿ƒç‹¬ç™½å†…å®¹ï¼ˆä¸ç¬¬ä¸€å¤©ä¸åŒï¼‰
        const innerThoughts = {
            "claudius": {
                title: "å…‹åŠ³ç‹„æ–¯çš„ç¬¬äºŒå¤©å†…å¿ƒç‹¬ç™½",
                thoughts: [
                    "ä½•éçš„æˆæ¼”å¾—çœŸä¸é”™ï¼Œä½†è¿™èƒ½å¸®æˆ‘æ‰¾åˆ°è¯æ®å—ï¼Ÿ",
                    "å¤§å®¶çš„è¡¨æƒ…éƒ½å¾ˆå¾®å¦™ï¼Œç‰¹åˆ«æ˜¯ç¨‹å©´ï¼Œä»–ä¼¼ä¹åœ¨æ€è€ƒä»€ä¹ˆã€‚",
                    "æ˜å¤©æ˜¯æœ€åæœŸé™äº†ï¼Œæˆ‘å¿…é¡»æ‹¿åˆ°é‚£ä¸ªè¯æ®ã€‚",
                    "çš‡å®«çš„ç§˜å¯†ä¸èƒ½å†æ‹–ä¸‹å»ï¼Œå¦åˆ™æˆ‘çš„ç‹ä½...",
                    "ä½•éï¼Œä½ åˆ°åº•çŸ¥é“å¤šå°‘ï¼Ÿ"
                ]
            },
            "chengying": {
                title: "ç¨‹å©´çš„ç¬¬äºŒå¤©å†…å¿ƒç‹¬ç™½",
                thoughts: [
                    "å…‹åŠ³ç‹„æ–¯çš„æœ€åé€šç‰’è®©æˆ‘å¾ˆä¸å®‰ã€‚",
                    "ä½•éçš„æˆè®©æˆ‘æƒ³èµ·äº†å‰ä»»å›½ç‹çš„æ­»å› ã€‚",
                    "æˆ‘æ‰‹ä¸­çš„è¯æï¼Œå¯èƒ½å°±æ˜¯è§£å¼€è°œå›¢çš„å…³é”®ã€‚",
                    "æ˜å¤©å¿…é¡»æ‰¾åˆ°çœŸç›¸ï¼Œå¦åˆ™ä¸€åˆ‡éƒ½æ™šäº†ã€‚",
                    "çš‡å®«é‡Œçš„æ¯ä¸ªäººéƒ½å€¼å¾—æ€€ç–‘ã€‚"
                ]
            },
            "hefei": {
                title: "ä½•éçš„ç¬¬äºŒå¤©å†…å¿ƒç‹¬ç™½",
                thoughts: [
                    "æˆ‘çš„æˆç»ˆäºæ¼”å®Œäº†ï¼Œå¸Œæœ›èƒ½ç»™å¤§å®¶ä¸€ç‚¹å¯å‘ã€‚",
                    "å…‹åŠ³ç‹„æ–¯çš„æœ€åé€šç‰’è®©æˆ‘å¾ˆç´§å¼ ã€‚",
                    "æˆ‘éœ€è¦æ›´å¤šçš„é’±æ¥è¿˜å€ºï¼Œä½†æ¡ˆå­ä¹Ÿè¦å°½å¿«è§£å†³ã€‚",
                    "æ˜å¤©æ˜¯å…³é”®çš„ä¸€å¤©ï¼Œæˆ‘è¦æŠŠæ¡å¥½æœºä¼šã€‚",
                    "æ¯ä¸ªäººéƒ½åœ¨éšè—ç§˜å¯†ï¼ŒåŒ…æ‹¬æˆ‘è‡ªå·±ã€‚"
                ]
            },
            "lixiang": {
                title: "ææƒ³çš„ç¬¬äºŒå¤©å†…å¿ƒç‹¬ç™½",
                thoughts: [
                    "å°¸ä½“æ˜¯åœ¨æˆ‘çš„è®¾è®¡åŒºåŸŸå‘ç°çš„ï¼Œè¿™è®©æˆ‘å¾ˆä¸å®‰ã€‚",
                    "ä½•éçš„æˆè®©æˆ‘æƒ³èµ·äº†é‚£äº›éšè—çš„å¯†é“ã€‚",
                    "æˆ‘çš„è®¾è®¡å›¾çº¸ä¸Šå¯èƒ½æœ‰çº¿ç´¢ã€‚",
                    "æ˜å¤©å¿…é¡»è¯æ˜æˆ‘çš„æ¸…ç™½ã€‚",
                    "çš‡å®«çš„åœ°ä¸‹ç³»ç»Ÿï¼Œéšè—ç€å¤ªå¤šç§˜å¯†ã€‚"
                ]
            },
            "wuzhizhe": {
                title: "å´æ™ºå“²çš„ç¬¬äºŒå¤©å†…å¿ƒç‹¬ç™½",
                thoughts: [
                    "å¯¼å¸ˆçš„ç¬”è®°è¶Šæ¥è¶Šé‡è¦äº†ã€‚",
                    "ä½•éçš„æˆè®©æˆ‘æƒ³èµ·äº†çš‡å®«çš„è®¾è®¡ç§˜å¯†ã€‚",
                    "æ˜å¤©æ˜¯æœ€åä¸€å¤©ï¼Œæˆ‘å¿…é¡»æ‰¾åˆ°çœŸç›¸ã€‚",
                    "å…‹åŠ³ç‹„æ–¯çš„å‹åŠ›è®©æˆ‘å–˜ä¸è¿‡æ°”ã€‚",
                    "å»ºç­‘çš„ç§˜å¯†ï¼Œå¯èƒ½æ”¹å˜ä¸€åˆ‡ã€‚"
                ]
            },
            "wangweiguo": {
                title: "ç‹å«å›½çš„ç¬¬äºŒå¤©å†…å¿ƒç‹¬ç™½",
                thoughts: [
                    "å·¥ç¨‹ä¸èƒ½å†æ‹–äº†ï¼Œå…‹åŠ³ç‹„æ–¯çš„æœ€åé€šç‰’å¾ˆä¸¥é‡ã€‚",
                    "ä½•éçš„æˆè®©æˆ‘æƒ³èµ·äº†é‚£äº›è¿é€çš„ç‰©èµ„ã€‚",
                    "æˆ‘çš„å‘¨æŠ¥å¯èƒ½æœ‰é‡è¦çš„çº¿ç´¢ã€‚",
                    "æ˜å¤©å¿…é¡»è§£å†³è¿™ä¸ªæ¡ˆå­ã€‚",
                    "çš‡å®«çš„å»ºè®¾ï¼Œä¸èƒ½å› ä¸ºè¿™èµ·æ¡ˆå­åœæ»ã€‚"
                ]
            }
        };

        // æ˜¾ç¤ºå†…å¿ƒç‹¬ç™½
        function showInnerThoughts() {
            const character = selectedCharacter;
            const thoughts = innerThoughts[character];

            if (!thoughts) {
                document.getElementById('inner-thoughts-content').innerHTML = `
                    <div class="page-container">
                        <h2>å†…å¿ƒç‹¬ç™½</h2>
                        <p>æš‚æ— å†…å¿ƒç‹¬ç™½å†…å®¹</p>
                    </div>
                `;
                return;
            }

            const thoughtsHtml = thoughts.thoughts.map((thought, index) => `
                <div class="thought-item" style="animation-delay: ${index * 0.5}s">
                    <div class="thought-bubble">
                        <p>${thought}</p>
                    </div>
                </div>
            `).join('');

            const html = `
                <div class="page-container">
                    <h2>${thoughts.title}</h2>

                    <div class="inner-thoughts-content">
                        <div class="character-header">
                            <div class="character-avatar">${window.characters[selectedCharacter].name.charAt(0)}</div>
                            <div class="character-info">
                                <h3>${window.characters[selectedCharacter].name} - ${window.characters[selectedCharacter].title}</h3>
                            </div>
                        </div>

                        <div class="thoughts-list">
                            ${thoughtsHtml}
                        </div>

                        <div class="thoughts-actions">
                            <button class="action-btn primary large" onclick="proceedToNextDay()">
                                ç»§ç»­è°ƒæŸ¥ - ç¬¬3å¤©
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('inner-thoughts-content').innerHTML = html;
            updateMobileInfoPanel();
        }

        // ç»§ç»­åˆ°ç¬¬ä¸‰å¤©
        function proceedToNextDay() {
            // æ›´æ–°æ¸¸æˆçŠ¶æ€åˆ°ç¬¬ä¸‰å¤©
            gameState.currentDay = 3;

            // ä¿å­˜çŠ¶æ€
            localStorage.setItem('qiyuanGameState', JSON.stringify(gameState));

            // è·³è½¬åˆ°ç¬¬ä¸‰å¤©çš„é€‰æ‹©é¡µé¢ï¼ˆæš‚æ—¶è·³è½¬åˆ°æ¸¸æˆä¸»é¡µï¼‰
            const gameUrl = `game.html?character=${selectedCharacter}&day=3&from=day2-thoughts`;
            window.location.href = gameUrl;
        }

        // æ›´æ–°ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function updateMobileInfoPanel() {
            const isMobile = window.innerWidth <= 768;

            // æ§åˆ¶æŒ‰é’®æ˜¾ç¤º
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.style.display = (isMobile && gameState.gameStarted) ? 'flex' : 'none';
            }

            if (!isMobile || !gameState.gameStarted) {
                hideMobileInfoPanel();
                return;
            }

            const char = window.characters[gameState.selectedCharacter];
            const panel = document.getElementById('mobile-info-panel');

            if (panel) {
                panel.innerHTML = `
                    <div class="character-info">
                        <strong>è§’è‰²ï¼š</strong>
                        <span>${char.name}</span><br>
                        <small style="color: #666;">${char.title}</small>
                    </div>

                    <h4>ğŸ“¦ èƒŒåŒ…</h4>
                    <div id="mobile-inventory">
                        ${gameState.playerInventory.length === 0 ?
                            '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                            gameState.playerInventory.map(item =>
                                `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${getItemDisplayName(item)}</div>`
                            ).join('')
                        }
                    </div>

                    <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                        <strong>ç¬¬ ${gameState.currentDay} å¤©</strong>
                    </div>
                `;
            }
        }

        // åˆ‡æ¢ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function toggleMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            if (panel) {
                const isVisible = panel.style.display === 'block';
                if (isVisible) {
                    hideMobileInfoPanel();
                } else {
                    const char = window.characters[gameState.selectedCharacter];
                    panel.innerHTML = `
                        <div class="character-info">
                            <strong>è§’è‰²ï¼š</strong>
                            <span>${char.name}</span><br>
                            <small style="color: #666;">${char.title}</small>
                        </div>

                        <h4>ğŸ“¦ èƒŒåŒ…</h4>
                        <div id="mobile-inventory">
                            ${gameState.playerInventory.length === 0 ?
                                '<div style="color: #999; font-style: italic;">èƒŒåŒ…æ˜¯ç©ºçš„</div>' :
                                gameState.playerInventory.map(item =>
                                    `<div style="padding: 8px; margin: 5px 0; background: #f5f5f5; border-radius: 5px;">${getItemDisplayName(item)}</div>`
                                ).join('')
                            }
                        </div>

                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
                            <strong>ç¬¬ ${gameState.currentDay} å¤©</strong>
                        </div>
                    `;
                    panel.style.display = 'block';
                    document.getElementById('mobile-overlay').style.display = 'block';
                    document.body.style.overflow = 'hidden';
                }
            }
        }

        // éšè—ç§»åŠ¨ç«¯ä¿¡æ¯é¢æ¿
        function hideMobileInfoPanel() {
            const panel = document.getElementById('mobile-info-panel');
            const overlay = document.getElementById('mobile-overlay');

            if (panel && overlay) {
                panel.style.display = 'none';
                overlay.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // äº‹ä»¶ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            loadGameState();
            showInnerThoughts();

            // ç§»åŠ¨ç«¯æŒ‰é’®äº‹ä»¶
            const mobileBtn = document.getElementById('mobile-info-btn');
            if (mobileBtn) {
                mobileBtn.addEventListener('click', toggleMobileInfoPanel);
            }

            // é®ç½©å±‚ç‚¹å‡»å…³é—­
            document.addEventListener('click', function(e) {
                if (e.target.id === 'mobile-overlay') {
                    hideMobileInfoPanel();
                }
            });

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 27) {
                    hideMobileInfoPanel();
                }
            });
        });
    </script>
</body>
</html>